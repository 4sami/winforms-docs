<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=9">
        <title>Using WaitingBar with a Background Worker</title>
		
        <link href="/devtools/winforms/favicon.ico?Version=2014" rel="shortcut icon" />
		
        <meta name="description" content="Using WaitingBar with a Background Worker">
        <link href="http://cdn.kendostatic.com/2014.2.716/styles/kendo.common.min.css" rel="stylesheet" />
        <link rel="stylesheet" href="/devtools/winforms/assets/styles-849dcaf701d866988e8c3593f15b66de.css">
        <link rel="stylesheet" href="/devtools/winforms/assets/theme-52ac78f88dc084a004a9f7d63a3c4245.css">
        <link rel="stylesheet" href="/devtools/winforms/assets/branding-fafb6ed99bf90d251675534381e6f139.css">
        <link rel="stylesheet" href="/devtools/winforms/assets/highlight-49ceada082f1c903edb130c25d09cf1f.css">
        <script src="http://code.jquery.com/jquery-1.10.2.js"></script>
        <script src="http://cdn.kendostatic.com/2014.2.716/js/kendo.web.min.js"></script>
        <script src="/devtools/winforms/assets/prettify-31f05a2784b46b14f119862e47123f4c.js"></script>
        <script src="/devtools/winforms/assets/app-6da8e8e1ef6e19ee4a020ec34f48078c.js"></script>
		<script src="/devtools/winforms/assets/prettify-31f05a2784b46b14f119862e47123f4c.js"></script>
        <script src="/devtools/winforms/assets/branding-59377013fb75f02a1dbffd638033ef6d.js"></script>
		<script src="/devtools/winforms/assets/feedback-76cd418a099f8d21592f412fb4a31191.js"></script>
		
		<!--[if lt IE 9]>
		<script>
		document.createElement('header');
		document.createElement('nav');
		document.createElement('section');
		document.createElement('article');
		document.createElement('aside');
		document.createElement('footer');
		document.createElement('hgroup');
		</script>
		<![endif]-->
    </head>
    <body class="faux-columns">
        <!-- Google Tag Manager -->
        <noscript>
            <iframe src="//www.googletagmanager.com/ns.html?id=GTM-6X92" height="0" width="0" style="display: none; visibility: hidden"></iframe>
        </noscript>
        <script>(function(w, d, s, l, i) { w[l] = w[l] || []; w[l].push({ 'gtm.start': new Date().getTime(), event: 'gtm.js' }); var f = d.getElementsByTagName(s)[0], j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : ''; j.async = true; j.src = '//www.googletagmanager.com/gtm.js?id=' + i + dl; f.parentNode.insertBefore(j, f); })(window, document, 'script', 'dataLayer', 'GTM-6X92');</script>
        <!-- End Google Tag Manager -->
        <header id="page-header">
			<span class="toggle-nav"><span></span></span>
            <div id="logo-bar">
	<a href="/devtools/winforms/" title="UI for WinForms">
		<span>UI for WinForms</span>
	</a>
</div> 
<div id="page-search">
	<script>
  (function() {
    var cx = '001595215763381649090:jt1stbj813w';
    var gcse = document.createElement('script');
    gcse.async = true;
    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
        '//www.google.com/cse/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>

</div>

<span class="show-search">
	<span class="k-icon k-i-search"></span>
</span>

<div class="nav-buttons">
	<a href="http://demos.telerik.com/" title="WinForms Demos" target="_blank" class="btn demos-btn">Demos</a>	
	<a href="http://www.telerik.com/products/winforms.aspx" title="About UI for WinForms" target="_blank" class="btn about-btn">About</a>
	<a href="http://www.telerik.com/purchase/individual/winforms.aspx" title="Pricing" target="_blank" class="btn pricing-btn">Pricing</a>
	<a href="http://www.telerik.com/products/winforms/download.aspx" title="Try now" target="_blank" class="btn btn-primary">Try now</a>
</div>





        </header>

        <div id="page-inner-content">
    <div id="page-nav">
        <div id="page-tree"></div>
        <script>
			$("#page-tree").kendoTreeView({
				dataSource: {
					transport: {
						read: {
							url: "/devtools/winforms/default.json",
							dataType: "json"
						}
					},
					schema: {
						model: {
							id: "path",
							children: "items",
							hasChildren: "items"
						}
					}
				},
				select: preventParentSelection,
				template: navigationTemplate("/devtools/winforms/"),
				dataBound: expandNavigation("track-and-status-controls/waitingbar/using-radwaitingbar-with-a-background-worker.html")
			});
        </script>
		<div id="page-api" class="k-treeview">
			<ul class="k-group">
				<li class="k-item">
					<span class="k-icon k-plus" role="presentation"></span>
					<span class="k-in">
						<a href="/devtools/winforms/api/" target="_blank">API Reference</a>
					</span>
				</li>
			</ul>
		</div>			
    </div>
	<a id="page-edit-link" class="btn btn-action" href="https://github.com/telerik/xaml-docs/edit/master/track-and-status-controls/waitingbar/using-radwaitingbar-with-a-background-worker.md">Edit this page</a>
    <div id="page-article">       
        <article>
            <h1 id="using-waitingbar-with-a-background-worker"><a href="#using-waitingbar-with-a-background-worker">Using WaitingBar with a Background Worker</a></h1>

<p>RadWaitingBar is a useful control for indicating that a long-running operation is <br>
    undergoing. When using this control, however, many users face a similar issue:<br>
    once the time-consuming operation is started, the control does not move its<br>
    indicators and literally freezes. Such cases occur when the long-running operation <br>
    is executed on the same thread as the RadWaitingBar waiting process: the primary UI Thread. <br>
    The operation does not allow the form to update its UI and as a result the control does <br>
    not perform any waiting animation.</p>

<p>One obvious solution is to start the time-consuming operation in a new thread. <br>
    The following example illustrates how to achieve this through a BackgroundWorker.</p>

<h2 id="backgroundworker-solution"><a href="#backgroundworker-solution">BackgroundWorker solution</a></h2>

<p>The aim of the sample application is to calculate numbers of the Fibonacci sequence. In a straight-forward scenario, the user selects the position of the Fibonacci number through a RadSpinEditor and clicks the Start RadButton to trigger the time-consuming operation. While the calculations are undergoing the RadWaitingBar smoothly animates its waiting indicators and the RadForm remains responsive. Once the number is calculated, the result is displayed and the RadWaitingBar control is stopped.<br>
            Below you will find snippets and comments which provide a detailed description of the sample application. Also, feel free to download the example project files appearing at the end of this tutorial. </p>

<p><img src="images/track-and-status-controls-waitingbar-using-radwaitingbar-with-a-background-worker001.png" alt="track-and-status-controls-waitingbar-using-radwaitingbar-with-a-background-worker 001"></p>

<ol>
<li>
</ol>

<p>When the form is loaded the BackgroundWorker instance should be initialized. Additionally, you should subscribe to two of its events: DoWork() and RunWorkerCompleted().</p>

<h4><strong>[C#]</strong></h4>

<pre><code>        private void Form1_Load(object sender, EventArgs e)
        {
            myBackgroundWorker = new BackgroundWorker();
            myBackgroundWorker.WorkerReportsProgress = true;
            myBackgroundWorker.WorkerSupportsCancellation = true;
            myBackgroundWorker.DoWork += new DoWorkEventHandler(myBackgroundWorker1_DoWork);
            myBackgroundWorker.RunWorkerCompleted += new RunWorkerCompletedEventHandler(myBackgroundWorker1_RunWorkerCompleted);
        }
</code></pre>

<h4><strong>[VB.NET]</strong></h4>

<pre><code>    Private Sub Form1_Load(ByVal sender As Object, ByVal e As EventArgs)
        myBackgroundWorker = New BackgroundWorker()
        myBackgroundWorker.WorkerReportsProgress = True
        myBackgroundWorker.WorkerSupportsCancellation = True
        AddHandler myBackgroundWorker.DoWork, AddressOf myBackgroundWorker1_DoWork
        AddHandler myBackgroundWorker.RunWorkerCompleted, AddressOf myBackgroundWorker1_RunWorkerCompleted
    End Sub
    '#End Region

    '#region workCompleted
    Private Sub myBackgroundWorker1_RunWorkerCompleted(ByVal sender As Object, ByVal e As RunWorkerCompletedEventArgs)
        Me.radWaitingBar1.StopWaiting()
        Me.radWaitingBar1.ResetWaiting()
        Me.radButton1.Enabled = True
        Me.radButton2.Enabled = False
        [end] = Date.Now

        If (e.Cancelled = True) Then
            Me.radLabel1.Text = "Calculations are canceled!"
        ElseIf Not (e.Error Is Nothing) Then
            Me.radLabel1.Text = ("Error: " &amp; e.Error.Message)
        Else
            Me.radLabel1.Text = "The " &amp; Me.radSpinEditor1.Value.ToString() &amp; "th member of the Fibonacci sequence is: " &amp; e.Result.ToString()
            Dim span As New TimeSpan()
            span = [end].Subtract(begin)

            Me.radLabel1.Text += vbLf &amp; "Calculating time: " &amp; span.TotalSeconds &amp; " seconds"
        End If
    End Sub
</code></pre>

<ol>
<li>
</ol>

<p>When the user clicks the Start RadButton, you should run the BackgroundWorker through the RunWorkerAsync() method and, also, start the RadWaitingBar waiting process using the StartWaiting() method.</p>

<h4><strong>[C#]</strong></h4>

<pre><code>        private void radButton1_Click(object sender, EventArgs e)
        {
            if (!myBackgroundWorker.IsBusy)
            {
                myBackgroundWorker.RunWorkerAsync(radSpinEditor1.Value);
                this.radButton1.Enabled = false;
                this.radButton2.Enabled = true;
                this.radWaitingBar1.StartWaiting();
                begin = DateTime.Now;
                this.radLabel1.Text = "Calculations in process...";
            }
        }
</code></pre>

<h4><strong>[VB.NET]</strong></h4>

<pre><code>    Private Sub radButton1_Click(ByVal sender As Object, ByVal e As EventArgs)
        If Not myBackgroundWorker.IsBusy Then
            myBackgroundWorker.RunWorkerAsync(radSpinEditor1.Value)
            Me.radButton1.Enabled = False
            Me.radButton2.Enabled = True
            Me.radWaitingBar1.StartWaiting()
            begin = Date.Now
            Me.radLabel1.Text = "Calculations in process..."
        End If
    End Sub
</code></pre>

<p><img src="images/track-and-status-controls-waitingbar-using-radwaitingbar-with-a-background-worker002.png" alt="track-and-status-controls-waitingbar-using-radwaitingbar-with-a-background-worker 002"></p>

<ol>
<li>
</ol>

<p>In the DoWork event handler you should execute the time-consuming operation, i.e. calculate the required Fibonacci number.</p>

<h4><strong>[C#]</strong></h4>

<pre><code>        void myBackgroundWorker1_DoWork(object sender, DoWorkEventArgs e)
        {
            BackgroundWorker worker = sender as BackgroundWorker;
            int n = Convert.ToInt32(e.Argument);
            e.Result = PerformComplexComputations(n, worker, e);
        }

        private long PerformComplexComputations(int n, BackgroundWorker worker, DoWorkEventArgs e)
        {
            long result = 0;

            if (worker.CancellationPending)
            {
                e.Cancel = true;
            }
            else
            {
                if (n &lt; 2) return 1;
                result = PerformComplexComputations(n - 1, worker, e) + PerformComplexComputations(n - 2, worker, e);
            }

            return result;
        }
</code></pre>

<h4><strong>[VB.NET]</strong></h4>

<pre><code>    Private Sub myBackgroundWorker1_DoWork(ByVal sender As Object, ByVal e As DoWorkEventArgs)
        Dim worker As BackgroundWorker = TryCast(sender, BackgroundWorker)
        Dim n As Integer = Convert.ToInt32(e.Argument)
        e.Result = PerformComplexComputations(n, worker, e)
    End Sub

    Private Function PerformComplexComputations(ByVal n As Integer, ByVal worker As BackgroundWorker, ByVal e As DoWorkEventArgs) As Long
        Dim result As Long = 0

        If worker.CancellationPending Then
            e.Cancel = True
        Else
            If n &lt; 2 Then
                Return 1
            End If
            result = PerformComplexComputations(n - 1, worker, e) + PerformComplexComputations(n - 2, worker, e)
        End If

        Return result
    End Function
</code></pre>

<ol>
<li>
</ol>

<p>When the long-running operation has completed, you should stop the RadWaitingBar control waiting process through the StopWaiting() method. Additionally, you should display the result to the user.</p>

<h4><strong>[C#]</strong></h4>

<pre><code>        void myBackgroundWorker1_RunWorkerCompleted(object sender, RunWorkerCompletedEventArgs e)
        {
            this.radWaitingBar1.StopWaiting();
            this.radWaitingBar1.ResetWaiting();
            this.radButton1.Enabled = true;
            this.radButton2.Enabled = false;
            end = DateTime.Now;

            if ((e.Cancelled == true))
            {
                this.radLabel1.Text = "Calculations are canceled!";
            }
            else if (!(e.Error == null))
            {
                this.radLabel1.Text = ("Error: " + e.Error.Message);
            }
            else
            {
                this.radLabel1.Text = "The " + this.radSpinEditor1.Value.ToString() + "th member of the Fibonacci sequence is: " + e.Result.ToString();
                TimeSpan span = new TimeSpan();
                span = end - begin;

                this.radLabel1.Text += "\nCalculating time: " + span.TotalSeconds + " seconds";
            }
        }
</code></pre>

<h4><strong>[VB.NET]</strong></h4>

<pre><code>    Private Sub myBackgroundWorker1_RunWorkerCompleted(ByVal sender As Object, ByVal e As RunWorkerCompletedEventArgs)
        Me.radWaitingBar1.StopWaiting()
        Me.radWaitingBar1.ResetWaiting()
        Me.radButton1.Enabled = True
        Me.radButton2.Enabled = False
        [end] = Date.Now

        If (e.Cancelled = True) Then
            Me.radLabel1.Text = "Calculations are canceled!"
        ElseIf Not (e.Error Is Nothing) Then
            Me.radLabel1.Text = ("Error: " &amp; e.Error.Message)
        Else
            Me.radLabel1.Text = "The " &amp; Me.radSpinEditor1.Value.ToString() &amp; "th member of the Fibonacci sequence is: " &amp; e.Result.ToString()
            Dim span As New TimeSpan()
            span = [end].Subtract(begin)

            Me.radLabel1.Text += vbLf &amp; "Calculating time: " &amp; span.TotalSeconds &amp; " seconds"
        End If
    End Sub
</code></pre>

<p><img src="images/track-and-status-controls-waitingbar-using-radwaitingbar-with-a-background-worker003.png" alt="track-and-status-controls-waitingbar-using-radwaitingbar-with-a-background-worker 003"></p>
        </article>
    </div>	
</div>

<footer>	
    <p><a onclick="javascript:SubmitFeedback('documentation@telerik.com','Telerik UI for WinForms','','','','%0\dYour%20feedback%20is%20used%20to%20improve%20the%20documentation%20and%20the%20product.%20Your%20e-mail%20address%20will%20not%20be%20used%20for%20any%20other%20purpose%20and%20is%20disposed%20of%20after%20the%20issue%20you%20report%20is%20resolved.%20%20While%20working%20to%20resolve%20the%20issue%20that%20you%20report,%20you%20may%20be%20contacted%20via%20e-mail%20to%20get%20further%20details%20or%20clarification%20on%20the%20feedback%20you%20sent.%20After%20the%20issue%20you%20report%20has%20been%20addressed,%20you%20may%20receive%20an%20e-mail%20to%20let%20you%20know%20that%20your%20feedback%20has%20been%20addressed.%0\A%0\d','Customer%20Feedback'); return false;" href="javascript:;" id="send-feedback">Send Feedback</a> Copyright &copy; 2002-<span id="toYear"></span> Telerik. All rights reserved.</p>
</footer>

    </body>
</html>

