<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=9">
        <title>Self-Referencing Hierarchy</title>
		
        <link href="/devtools/winforms/favicon.ico?Version=2014" rel="shortcut icon" />
		
        <meta name="description" content="Self-Referencing Hierarchy">
        <link href="http://cdn.kendostatic.com/2014.2.716/styles/kendo.common.min.css" rel="stylesheet" />
        <link rel="stylesheet" href="/devtools/winforms/assets/styles-849dcaf701d866988e8c3593f15b66de.css">
        <link rel="stylesheet" href="/devtools/winforms/assets/theme-52ac78f88dc084a004a9f7d63a3c4245.css">
        <link rel="stylesheet" href="/devtools/winforms/assets/branding-fafb6ed99bf90d251675534381e6f139.css">
        <link rel="stylesheet" href="/devtools/winforms/assets/highlight-49ceada082f1c903edb130c25d09cf1f.css">
        <script src="http://code.jquery.com/jquery-1.10.2.js"></script>
        <script src="http://cdn.kendostatic.com/2014.2.716/js/kendo.web.min.js"></script>
        <script src="/devtools/winforms/assets/prettify-31f05a2784b46b14f119862e47123f4c.js"></script>
        <script src="/devtools/winforms/assets/app-6da8e8e1ef6e19ee4a020ec34f48078c.js"></script>
		<script src="/devtools/winforms/assets/prettify-31f05a2784b46b14f119862e47123f4c.js"></script>
        <script src="/devtools/winforms/assets/branding-59377013fb75f02a1dbffd638033ef6d.js"></script>
		<script src="/devtools/winforms/assets/feedback-76cd418a099f8d21592f412fb4a31191.js"></script>
		
		<!--[if lt IE 9]>
		<script>
		document.createElement('header');
		document.createElement('nav');
		document.createElement('section');
		document.createElement('article');
		document.createElement('aside');
		document.createElement('footer');
		document.createElement('hgroup');
		</script>
		<![endif]-->
    </head>
    <body class="faux-columns">
        <!-- Google Tag Manager -->
        <noscript>
            <iframe src="//www.googletagmanager.com/ns.html?id=GTM-6X92" height="0" width="0" style="display: none; visibility: hidden"></iframe>
        </noscript>
        <script>(function(w, d, s, l, i) { w[l] = w[l] || []; w[l].push({ 'gtm.start': new Date().getTime(), event: 'gtm.js' }); var f = d.getElementsByTagName(s)[0], j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : ''; j.async = true; j.src = '//www.googletagmanager.com/gtm.js?id=' + i + dl; f.parentNode.insertBefore(j, f); })(window, document, 'script', 'dataLayer', 'GTM-6X92');</script>
        <!-- End Google Tag Manager -->
        <header id="page-header">
			<span class="toggle-nav"><span></span></span>
            <div id="logo-bar">
	<a href="/devtools/winforms/" title="UI for WinForms">
		<span>UI for WinForms</span>
	</a>
</div> 
<div id="page-search">
	<script>
  (function() {
    var cx = '001595215763381649090:jt1stbj813w';
    var gcse = document.createElement('script');
    gcse.async = true;
    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
        '//www.google.com/cse/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>

</div>

<span class="show-search">
	<span class="k-icon k-i-search"></span>
</span>

<div class="nav-buttons">
	<a href="http://demos.telerik.com/" title="WinForms Demos" target="_blank" class="btn demos-btn">Demos</a>	
	<a href="http://www.telerik.com/products/winforms.aspx" title="About UI for WinForms" target="_blank" class="btn about-btn">About</a>
	<a href="http://www.telerik.com/purchase/individual/winforms.aspx" title="Pricing" target="_blank" class="btn pricing-btn">Pricing</a>
	<a href="http://www.telerik.com/products/winforms/download.aspx" title="Try now" target="_blank" class="btn btn-primary">Try now</a>
</div>





        </header>

        <div id="page-inner-content">
    <div id="page-nav">
        <div id="page-tree"></div>
        <script>
			$("#page-tree").kendoTreeView({
				dataSource: {
					transport: {
						read: {
							url: "/devtools/winforms/default.json",
							dataType: "json"
						}
					},
					schema: {
						model: {
							id: "path",
							children: "items",
							hasChildren: "items"
						}
					}
				},
				select: preventParentSelection,
				template: navigationTemplate("/devtools/winforms/"),
				dataBound: expandNavigation("gridview/hierarchical-grid/self-referencing-hierarchy.html")
			});
        </script>
		<div id="page-api" class="k-treeview">
			<ul class="k-group">
				<li class="k-item">
					<span class="k-icon k-plus" role="presentation"></span>
					<span class="k-in">
						<a href="/devtools/winforms/api/" target="_blank">API Reference</a>
					</span>
				</li>
			</ul>
		</div>			
    </div>
	<a id="page-edit-link" class="btn btn-action" href="https://github.com/telerik/xaml-docs/edit/master/gridview/hierarchical-grid/self-referencing-hierarchy.md">Edit this page</a>
    <div id="page-article">       
        <article>
            <h1 id="self-referencing-hierarchy"><a href="#self-referencing-hierarchy">Self-Referencing Hierarchy</a></h1>

<table>
<th></th>
<tr>
<td>

RELATED VIDEOS</td>
<td></td>
</tr>
<tr>
<td>

[Binding RadGridView for WinForms to a Self Referencing Hierarchy](http://tv.telerik.com/watch/winforms/binding-radgridview-for-winforms-to-self-referencing-hierarchy)

In this video, you will learn how to display a self referencing hierarchy inside of RadGridView for WinForms.
            </td>
<td>![gridview-hierarchical-grid-self-referencing-hierarchy 002](images/gridview-hierarchical-grid-self-referencing-hierarchy002.png)</td>
</tr>
</table>

<p>Except displaying hierarchical data and applying some custom criteria about when the subset<br>
        of data to be displayed, the RadGridView allows you to define a relation that points back to<br>
        the same table. In the cases when the hierarchical data is build from one type of items you can<br>
        use a self referencing RadGridView to display the data.</p>

<h2 id="self-referencing-example"><a href="#self-referencing-example">Self-Referencing Example</a></h2>

<p>The following example demonstrates how RadGridView displays a hierarchy based on the<br>
          data provided by the file system where one folder can have files and folders that can have<br>
          other files and folders, etc.<br>
        <img src="images/gridview-hierarchical-grid-self-referencing-hierarchy001.png" alt="gridview-hierarchical-grid-self-referencing-hierarchy 001"></p>

<p>In order to achieve the look of the RadGridView from the screenshot above, we<br>
          need to follow these steps:</p>

<ol>
<li>Create a datasource with an appropriate structure where each data record contains Id
          that serves as a unique identifier for the record and ParentId that determines the parent of the data record.
          In our case this is a business object of type FileSystemItem that can serve as a folder and as a document.</li>
</ol>

<h4><strong>[C#]</strong></h4>

<pre><code>    public class FileSystemItem
    {
        int id;
        string name;
        DateTime creationTime;
        int parentFolderId;
        private string type;

        public int Id
        {
            get
            {
                return id;
            }
            set
            {
                id = value;
            }
        }

        public string FileSystemInfoType
        {
            get
            {
                return type;
            }
            set
            {
                type = value;
            }
        }

        public string Name
        {
            get
            {
                return name;
            }
            set
            {
                name = value;
            }
        }

        public DateTime CreationTime
        {
            get
            {
                return creationTime;
            }
            set
            {
                creationTime = value;
            }
        }

        public int ParentFolderId
        {
            get
            {
                return parentFolderId;
            }
            set
            {
                parentFolderId = value;
            }
        }

        public FileSystemItem(int id, string type, string name, DateTime creationTime, int parentFolderId)
        {
            this.id = id;
            this.type = type;
            this.name = name;
            this.creationTime = creationTime;
            this.parentFolderId = parentFolderId;
        }
    }
</code></pre>

<h4><strong>[VB.NET]</strong></h4>

<pre><code>Public Class FileSystemItem
    Private id_Renamed As Integer
    Private name_Renamed As String
    Private creationTime_Renamed As Date
    Private parentFolderId_Renamed As Integer

    Private type As String

    Public Property Id() As Integer
        Get
            Return id_Renamed
        End Get
        Set(ByVal value As Integer)
            id_Renamed = value
        End Set
    End Property

    Public Property FileSystemInfoType() As String
        Get
            Return type
        End Get
        Set(ByVal value As String)
            type = value
        End Set
    End Property

    Public Property Name() As String
        Get
            Return name_Renamed
        End Get
        Set(ByVal value As String)
            name_Renamed = value
        End Set
    End Property

    Public Property CreationTime() As Date
        Get
            Return creationTime_Renamed
        End Get
        Set(ByVal value As Date)
            creationTime_Renamed = value
        End Set
    End Property

    Public Property ParentFolderId() As Integer
        Get
            Return parentFolderId_Renamed
        End Get
        Set(ByVal value As Integer)
            parentFolderId_Renamed = value
        End Set
    End Property

    Public Sub New(ByVal id As Integer, ByVal type As String, ByVal name As String, ByVal creationTime As Date, ByVal parentFolderId As Integer)
        Me.id_Renamed = id
        Me.type = type
        Me.name_Renamed = name
        Me.creationTime_Renamed = creationTime
        Me.parentFolderId_Renamed = parentFolderId
    End Sub
End Class
</code></pre>

<ol>
<li>Fill a BindingList with objects of type FileSystemItem. The content of the list will depend on the
          content of the "C:\Program Files (x86)\Telerik" folder:</li>
</ol>

<h4><strong>[C#]</strong></h4>

<pre><code>        BindingList&lt;FileSystemItem&gt; list = new BindingList&lt;FileSystemItem&gt;();
        int fileFolderIndex = 0;

        public void GetFilesAndFolders(string dir, int parentId)
        {
            DirectoryInfo di = new DirectoryInfo(dir);
            FileInfo[] rgFiles = di.GetFiles();
            foreach (FileInfo fi in rgFiles)
            {
                fileFolderIndex++;
                list.Add(new FileSystemItem(fileFolderIndex, "File", fi.Name, fi.CreationTime, parentId));
            }

            DirectoryInfo[] dirs = di.GetDirectories();
            foreach (DirectoryInfo d in dirs)
            {
                fileFolderIndex++;
                list.Add(new FileSystemItem(fileFolderIndex, "Folder", d.Name, d.CreationTime, parentId));
                GetFilesAndFolders(d.FullName, fileFolderIndex);
            }
        }
</code></pre>

<h4><strong>[VB.NET]</strong></h4>

<pre><code>    Private list As New BindingList(Of FileSystemItem)()
    Private fileFolderIndex As Integer = 0

    Public Sub GetFilesAndFolders(ByVal dir As String, ByVal parentId As Integer)
        Dim di As New DirectoryInfo(dir)
        Dim rgFiles() As FileInfo = di.GetFiles()
        For Each fi As FileInfo In rgFiles
            fileFolderIndex += 1
            list.Add(New FileSystemItem(fileFolderIndex, "File", fi.Name, fi.CreationTime, parentId))
        Next fi

        Dim dirs() As DirectoryInfo = di.GetDirectories()
        For Each d As DirectoryInfo In dirs
            fileFolderIndex += 1
            list.Add(New FileSystemItem(fileFolderIndex, "Folder", d.Name, d.CreationTime, parentId))
            GetFilesAndFolders(d.FullName, fileFolderIndex)
        Next d
    End Sub
</code></pre>

<ol>
<li>The most important step of this example - setting up the Self Referencing mode of RadGridView. To do this, you should
          call the <strong>AddSelfReference</strong> method of the <strong>Relations</strong> collection
          passing the template that should reflect the structure of the business object and the properties that should
          determine the parent-child relation:</li>
</ol>

<h4><strong>[C#]</strong></h4>

<pre><code>            this.radGridView1.Relations.AddSelfReference(this.radGridView1.MasterTemplate, "Id", "ParentFolderId");
            this.radGridView1.DataSource = list;
</code></pre>

<h4><strong>[VB.NET]</strong></h4>

<pre><code>        Me.RadGridView1.Relations.AddSelfReference(Me.RadGridView1.MasterTemplate, "Id", "ParentFolderId")
        Me.RadGridView1.DataSource = list
</code></pre>

<ol>
<li>Hide the columns that are not useful to your clients. These columns in our case are Id, ParentFolderId and
          FileSystemInfoType:</li>
</ol>

<h4><strong>[C#]</strong></h4>

<pre><code>            this.radGridView1.Columns["Id"].IsVisible = false;
            this.radGridView1.Columns["ParentFolderId"].IsVisible = false;
            this.radGridView1.Columns["FileSystemInfoType"].IsVisible = false;
</code></pre>

<h4><strong>[VB.NET]</strong></h4>

<pre><code>        Me.RadGridView1.Columns("Id").IsVisible = False
        Me.RadGridView1.Columns("ParentFolderId").IsVisible = False
        Me.RadGridView1.Columns("FileSystemInfoType").IsVisible = False
</code></pre>

<ol>
<li>Last, but not least, you may want to show different images depending on the actual file system types of the data records.
          To do this, you should handle the CellFormatting event, check if the FileSystemInfoType is
          <em>File</em> or <em>Folder</em> and
          set the appropriate image accordingly:</li>
</ol>

<h4><strong>[C#]</strong></h4>

<pre><code>        // Getting the images from the resources of the project
        Image documentImage = SamplesCS.Properties.Resources.Document;
        Image folderImage = SamplesCS.Properties.Resources.Folder;

        void radGridView1_CellFormatting(object sender, Telerik.WinControls.UI.CellFormattingEventArgs e)
        {
            GridDataCellElement dataCell = e.CellElement as GridDataCellElement;

            if (dataCell.ColumnInfo.Name == "Name")
            {
                GridViewDataRowInfo dataRow = dataCell.RowInfo as GridViewDataRowInfo;
                if (dataRow != null)
                {
                    dataCell.ImageAlignment = ContentAlignment.MiddleLeft;

                    string valueType = Convert.ToString(dataRow.Cells["FileSystemInfoType"].Value).ToUpperInvariant();

                    if (valueType.Contains("FILE"))
                    {
                        dataCell.Image = documentImage;
                    }
                    else
                    {
                        dataCell.Image = folderImage;
                    }

                    dataCell.TextImageRelation = TextImageRelation.ImageBeforeText;
                }
            }
            else
            {
                dataCell.ResetValue(LightVisualElement.ImageProperty, Telerik.WinControls.ValueResetFlags.Local);
                dataCell.ResetValue(LightVisualElement.ImageAlignmentProperty, Telerik.WinControls.ValueResetFlags.Local);
                dataCell.ResetValue(LightVisualElement.TextImageRelationProperty, Telerik.WinControls.ValueResetFlags.Local);
                dataCell.ResetValue(LightVisualElement.ImageLayoutProperty, Telerik.WinControls.ValueResetFlags.Local);
            }
        }
</code></pre>

<h4><strong>[VB.NET]</strong></h4>

<pre><code>    ' Getting the images from the resources of the project
    Private documentImage As Image = SamplesVB.My.Resources.Document
    Private folderImage As Image = SamplesVB.My.Resources.Folder

    Private Sub radGridView1_CellFormatting(ByVal sender As Object, ByVal e As Telerik.WinControls.UI.CellFormattingEventArgs)
        Dim dataCell As GridDataCellElement = TryCast(e.CellElement, GridDataCellElement)

        If dataCell.ColumnInfo.Name = "Name" Then
            Dim dataRow As GridViewDataRowInfo = TryCast(dataCell.RowInfo, GridViewDataRowInfo)
            If dataRow IsNot Nothing Then
                dataCell.ImageAlignment = ContentAlignment.MiddleLeft

                Dim valueType As String = Convert.ToString(dataRow.Cells("FileSystemInfoType").Value).ToUpperInvariant()

                If valueType.Contains("FILE") Then
                    dataCell.Image = documentImage
                Else
                    dataCell.Image = folderImage
                End If

                dataCell.TextImageRelation = TextImageRelation.ImageBeforeText
            End If
        Else
            dataCell.ResetValue(LightVisualElement.ImageProperty, Telerik.WinControls.ValueResetFlags.Local)
            dataCell.ResetValue(LightVisualElement.ImageAlignmentProperty, Telerik.WinControls.ValueResetFlags.Local)
            dataCell.ResetValue(LightVisualElement.TextImageRelationProperty, Telerik.WinControls.ValueResetFlags.Local)
            dataCell.ResetValue(LightVisualElement.ImageLayoutProperty, Telerik.WinControls.ValueResetFlags.Local)
        End If
    End Sub
</code></pre>

<p>This is it! In just a few steps we created a good looking self-referencing multi-column tree.</p>
        </article>
    </div>	
</div>

<footer>	
    <p><a onclick="javascript:SubmitFeedback('documentation@telerik.com','Telerik UI for WinForms','','','','%0\dYour%20feedback%20is%20used%20to%20improve%20the%20documentation%20and%20the%20product.%20Your%20e-mail%20address%20will%20not%20be%20used%20for%20any%20other%20purpose%20and%20is%20disposed%20of%20after%20the%20issue%20you%20report%20is%20resolved.%20%20While%20working%20to%20resolve%20the%20issue%20that%20you%20report,%20you%20may%20be%20contacted%20via%20e-mail%20to%20get%20further%20details%20or%20clarification%20on%20the%20feedback%20you%20sent.%20After%20the%20issue%20you%20report%20has%20been%20addressed,%20you%20may%20receive%20an%20e-mail%20to%20let%20you%20know%20that%20your%20feedback%20has%20been%20addressed.%0\A%0\d','Customer%20Feedback'); return false;" href="javascript:;" id="send-feedback">Send Feedback</a> Copyright &copy; 2002-<span id="toYear"></span> Telerik. All rights reserved.</p>
</footer>

    </body>
</html>

