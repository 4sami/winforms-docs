<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=9">
        <title>Importing XML from MS Project</title>
		
        <link href="/devtools/winforms/favicon.ico?Version=2014" rel="shortcut icon" />
		
        <meta name="description" content="Importing XML from MS Project">
        <link href="http://cdn.kendostatic.com/2014.2.716/styles/kendo.common.min.css" rel="stylesheet" />
        <link rel="stylesheet" href="/devtools/winforms/assets/styles-0b5a71aa940403cb3ac60d7e91e25e1d.css">
        <link rel="stylesheet" href="/devtools/winforms/assets/theme-52ac78f88dc084a004a9f7d63a3c4245.css">
        <link rel="stylesheet" href="/devtools/winforms/assets/branding-fafb6ed99bf90d251675534381e6f139.css">
        <link rel="stylesheet" href="/devtools/winforms/assets/highlight-49ceada082f1c903edb130c25d09cf1f.css">
        <script src="http://code.jquery.com/jquery-1.10.2.js"></script>
        <script src="http://cdn.kendostatic.com/2014.2.716/js/kendo.web.min.js"></script>
        <script src="/devtools/winforms/assets/prettify-31f05a2784b46b14f119862e47123f4c.js"></script>
        <script src="/devtools/winforms/assets/app-6da8e8e1ef6e19ee4a020ec34f48078c.js"></script>
		<script src="/devtools/winforms/assets/prettify-31f05a2784b46b14f119862e47123f4c.js"></script>
        <script src="/devtools/winforms/assets/branding-59377013fb75f02a1dbffd638033ef6d.js"></script>
		<script src="/devtools/winforms/assets/feedback-76cd418a099f8d21592f412fb4a31191.js"></script>
		
		<!--[if lt IE 9]>
		<script>
		document.createElement('header');
		document.createElement('nav');
		document.createElement('section');
		document.createElement('article');
		document.createElement('aside');
		document.createElement('footer');
		document.createElement('hgroup');
		</script>
		<![endif]-->
    </head>
    <body class="faux-columns">
        <!-- Google Tag Manager -->
        <noscript>
            <iframe src="//www.googletagmanager.com/ns.html?id=GTM-6X92" height="0" width="0" style="display: none; visibility: hidden"></iframe>
        </noscript>
        <script>(function(w, d, s, l, i) { w[l] = w[l] || []; w[l].push({ 'gtm.start': new Date().getTime(), event: 'gtm.js' }); var f = d.getElementsByTagName(s)[0], j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : ''; j.async = true; j.src = '//www.googletagmanager.com/gtm.js?id=' + i + dl; f.parentNode.insertBefore(j, f); })(window, document, 'script', 'dataLayer', 'GTM-6X92');</script>
        <!-- End Google Tag Manager -->
        <header id="page-header">
			<span class="toggle-nav"><span></span></span>
            


<div id="page-search">
	<script>
  (function() {
    var cx = '001595215763381649090:jt1stbj813w';
    var gcse = document.createElement('script');
    gcse.async = true;
    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
        '//www.google.com/cse/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>

</div>

<span class="show-search">
	<span class="k-icon k-i-search"></span>
</span>

<div class="nav-buttons">


</div>





        </header>

        <div id="page-inner-content">
    <div id="page-nav">
        <div id="page-tree"></div>
        <script>
			$("#page-tree").kendoTreeView({
				dataSource: {
					transport: {
						read: {
							url: "/devtools/winforms/default.json",
							dataType: "json"
						}
					},
					schema: {
						model: {
							id: "path",
							children: "items",
							hasChildren: "items"
						}
					}
				},
				select: preventParentSelection,
				template: navigationTemplate("/devtools/winforms/"),
				dataBound: expandNavigation("ganttview/working-with-data/ganttview-importing-xml-from-msproject.html")
			});
        </script>
		<div id="page-api" class="k-treeview">
			<ul class="k-group">
				<li class="k-item">
					<span class="k-icon k-plus" role="presentation"></span>
					<span class="k-in">
						<a href="/devtools/winforms/api/" target="_blank">API Reference</a>
					</span>
				</li>
			</ul>
		</div>			
    </div>
	<a id="page-edit-link" class="btn btn-action" href="https://github.com/telerik/xaml-docs/edit/master/ganttview/working-with-data/ganttview-importing-xml-from-msproject.md">Edit this page</a>
    <div id="page-article">       
        <article>
            <h1 id="importing-xml-from-ms-project"><a href="#importing-xml-from-ms-project">Importing XML from MS Project</a></h1>

<p>Although RadGanttView does not support direct binding or importing of MS Project files we have prepared a class that would help <br>
          you import an MS Project saved as xml into RadGanttView.</p>

<h4>__[C#] __</h4>

<pre><code>    public class MsProjectImporter
    {
        private Dictionary&lt;int, List&lt;DataRow&gt;&gt; tasksByLevel;
        private DataSet dataSet;

        public DataSet GetData(TextReader reader)
        {
            XmlDocument doc = new XmlDocument();
            doc.Load(reader);

            this.InitializeDataStructures();
            this.ExtractTasks(doc);
            ImporterNode root = this.BuildTasksHierarchy();
            this.SaveTasksDataTable(root);
            this.SaveLinksDataTable(doc);

            return this.dataSet;
        }

        private void InitializeDataStructures()
        {
            this.tasksByLevel = new Dictionary&lt;int, List&lt;DataRow&gt;&gt;();
            DataTable tasks = new DataTable("Tasks");
            tasks.Columns.Add("Id", typeof(int));
            tasks.Columns.Add("ParentId", typeof(int));
            tasks.Columns.Add("Title", typeof(string));
            tasks.Columns.Add("Start", typeof(DateTime));
            tasks.Columns.Add("End", typeof(DateTime));
            tasks.Columns.Add("Progress", typeof(decimal));
            tasks.Columns.Add("Outline", typeof(string));

            DataTable links = new DataTable("Links");
            links.Columns.Add("StartId", typeof(int));
            links.Columns.Add("EndId", typeof(int));
            links.Columns.Add("LinkType", typeof(int));

            this.dataSet = new DataSet();
            this.dataSet.Tables.Add(tasks);
            this.dataSet.Tables.Add(links);
        }

        private ImporterNode BuildTasksHierarchy()
        {
            ImporterNode root = null;

            foreach (int key in this.tasksByLevel.Keys)
            {
                if (key == 0)
                {
                    root = new ImporterNode();
                    root.Row = this.tasksByLevel[key][0];

                    continue;
                }

                foreach (DataRow row in this.tasksByLevel[key])
                {
                    List&lt;string&gt; outlineIndexes = new List&lt;string&gt;(row["Outline"].ToString().Split('.'));

                    ImporterNode parent = root;

                    while (outlineIndexes.Count &gt; 1)
                    {
                        parent = parent.Children[int.Parse(outlineIndexes[0]) - 1];
                        outlineIndexes.RemoveAt(0);
                    }

                    ImporterNode newNode = new ImporterNode();
                    newNode.Row = row;
                    newNode.Row["ParentId"] = parent.Row["Id"];
                    parent.Children.Add(newNode);
                }
            }

            return root;
        }

        private void ExtractTasks(XmlDocument doc)
        {
            foreach (XmlNode node in doc.DocumentElement["Tasks"].ChildNodes)
            {
                if (node["OutlineNumber"] == null)
                {
                    continue;
                }

                DataRow row = this.dataSet.Tables["Tasks"].NewRow();
                int outlineLevel = int.Parse(node["OutlineLevel"].InnerText);
                int id = int.Parse(node["UID"].InnerText);
                row["Id"] = id;
                row["ParentId"] = 0;
                row["Title"] = node["Name"].InnerText;
                row["Start"] = DateTime.Parse(node["Start"].InnerText);
                row["End"] = DateTime.Parse(node["Finish"].InnerText);
                row["Progress"] = decimal.Parse(node["PercentComplete"].InnerText);
                row["Outline"] = node["OutlineNumber"].InnerText;

                if (this.tasksByLevel.ContainsKey(outlineLevel))
                {
                    this.tasksByLevel[outlineLevel].Add(row);
                }
                else
                {
                    this.tasksByLevel.Add(outlineLevel, new List&lt;DataRow&gt;() { row });
                }
            }
        }

        private void SaveTasksDataTable(ImporterNode root)
        {
            Queue&lt;ImporterNode&gt; queue = new Queue&lt;ImporterNode&gt;();

            foreach (ImporterNode node in root.Children)
            {
                queue.Enqueue(node);
            }

            while (queue.Count &gt; 0)
            {
                ImporterNode node = queue.Dequeue();

                foreach (ImporterNode item in node.Children)
                {
                    queue.Enqueue(item);
                }

                this.dataSet.Tables["Tasks"].Rows.Add(node.Row);
            }

            dataSet.Tables["Tasks"].Columns.Remove("Outline");
        }

        private void SaveLinksDataTable(XmlDocument doc)
        {
            foreach (XmlNode node in doc.DocumentElement["Tasks"].ChildNodes)
            {
                XmlNode predecessor = node["PredecessorLink"];

                if (predecessor != null)
                {
                    int id = int.Parse(node["UID"].InnerText);
                    int startId = int.Parse(predecessor["PredecessorUID"].InnerText);
                    int linkType = int.Parse(predecessor["Type"].InnerText);

                    this.dataSet.Tables["Links"].Rows.Add(startId, id, linkType);
                }
            }
        }
    }

    public class ImporterNode
    {
        private DataRow row;
        private List&lt;ImporterNode&gt; children;

        public ImporterNode()
        {
            this.children = new List&lt;ImporterNode&gt;();
        }

        public DataRow Row
        {
            get { return row; }
            set { row = value; }
        }

        public List&lt;ImporterNode&gt; Children
        {
            get { return children; }
        }
    }
</code></pre>

<h4>__[VB.NET] __</h4>

<pre><code>Public Class MsProjectImporter
    Private tasksByLevel As Dictionary(Of Integer, List(Of DataRow))
    Private dataSet As DataSet

    Public Function GetData(reader As TextReader) As DataSet
        Dim doc As New XmlDocument()
        doc.Load(reader)

        Me.InitializeDataStructures()
        Me.ExtractTasks(doc)
        Dim root As ImporterNode = Me.BuildTasksHierarchy()
        Me.SaveTasksDataTable(root)
        Me.SaveLinksDataTable(doc)

        Return Me.dataSet
    End Function

    Private Sub InitializeDataStructures()
        Me.tasksByLevel = New Dictionary(Of Integer, List(Of DataRow))()
        Dim tasks As New DataTable("Tasks")
        tasks.Columns.Add("Id", GetType(Integer))
        tasks.Columns.Add("ParentId", GetType(Integer))
        tasks.Columns.Add("Title", GetType(String))
        tasks.Columns.Add("Start", GetType(DateTime))
        tasks.Columns.Add("End", GetType(DateTime))
        tasks.Columns.Add("Progress", GetType(Decimal))
        tasks.Columns.Add("Outline", GetType(String))

        Dim links As New DataTable("Links")
        links.Columns.Add("StartId", GetType(Integer))
        links.Columns.Add("EndId", GetType(Integer))
        links.Columns.Add("LinkType", GetType(Integer))

        Me.dataSet = New DataSet()
        Me.dataSet.Tables.Add(tasks)
        Me.dataSet.Tables.Add(links)
    End Sub

    Private Function BuildTasksHierarchy() As ImporterNode
        Dim root As ImporterNode = Nothing

        For Each key As Integer In Me.tasksByLevel.Keys
            If key = 0 Then
                root = New ImporterNode()
                root.Row = Me.tasksByLevel(key)(0)

                Continue For
            End If

            For Each row As DataRow In Me.tasksByLevel(key)
                Dim outlineIndexes As New List(Of String)(row("Outline").ToString().Split("."c))

                Dim parent As ImporterNode = root

                While outlineIndexes.Count &gt; 1
                    parent = parent.Children(Integer.Parse(outlineIndexes(0)) - 1)
                    outlineIndexes.RemoveAt(0)
                End While

                Dim newNode As New ImporterNode()
                newNode.Row = row
                newNode.Row("ParentId") = parent.Row("Id")
                parent.Children.Add(newNode)
            Next
        Next

        Return root
    End Function

    Private Sub ExtractTasks(doc As XmlDocument)
        For Each node As XmlNode In doc.DocumentElement("Tasks").ChildNodes
            If node("OutlineNumber") Is Nothing Then
                Continue For
            End If

            Dim row As DataRow = Me.dataSet.Tables("Tasks").NewRow()
            Dim outlineLevel As Integer = Integer.Parse(node("OutlineLevel").InnerText)
            Dim id As Integer = Integer.Parse(node("UID").InnerText)
            row("Id") = id
            row("ParentId") = 0
            row("Title") = node("Name").InnerText
            row("Start") = DateTime.Parse(node("Start").InnerText)
            row("End") = DateTime.Parse(node("Finish").InnerText)
            row("Progress") = Decimal.Parse(node("PercentComplete").InnerText)
            row("Outline") = node("OutlineNumber").InnerText

            If Me.tasksByLevel.ContainsKey(outlineLevel) Then
                Me.tasksByLevel(outlineLevel).Add(row)
            Else
                Me.tasksByLevel.Add(outlineLevel, New List(Of DataRow)() From { _
                 row _
                })
            End If
        Next
    End Sub

    Private Sub SaveTasksDataTable(root As ImporterNode)
        Dim queue As New Queue(Of ImporterNode)()

        For Each node As ImporterNode In root.Children
            queue.Enqueue(node)
        Next

        While queue.Count &gt; 0
            Dim node As ImporterNode = queue.Dequeue()

            For Each item As ImporterNode In node.Children
                queue.Enqueue(item)
            Next

            Me.dataSet.Tables("Tasks").Rows.Add(node.Row)
        End While

        dataSet.Tables("Tasks").Columns.Remove("Outline")
    End Sub

    Private Sub SaveLinksDataTable(doc As XmlDocument)
        For Each node As XmlNode In doc.DocumentElement("Tasks").ChildNodes
            Dim predecessor As XmlNode = node("PredecessorLink")

            If predecessor IsNot Nothing Then
                Dim id As Integer = Integer.Parse(node("UID").InnerText)
                Dim startId As Integer = Integer.Parse(predecessor("PredecessorUID").InnerText)
                Dim linkType As Integer = Integer.Parse(predecessor("Type").InnerText)

                Me.dataSet.Tables("Links").Rows.Add(startId, id, linkType)
            End If
        Next
    End Sub
End Class

Public Class ImporterNode
    Private m_row As DataRow
    Private m_children As List(Of ImporterNode)

    Public Sub New()
        Me.m_children = New List(Of ImporterNode)()
    End Sub

    Public Property Row() As DataRow
        Get
            Return m_row
        End Get
        Set(value As DataRow)
            m_row = value
        End Set
    End Property

    Public ReadOnly Property Children() As List(Of ImporterNode)
        Get
            Return m_children
        End Get
    End Property

End Class
</code></pre>

<p>After you have this code in your project you can load the data from the xml into RadGanttView with the following code:</p>

<h4>__[C#] __</h4>

<pre><code>            string fileLocation = @"C:\file.xml";
            MsProjectImporter importer = new MsProjectImporter(); 
            StringReader reader = new StringReader(fileLocation); 
            DataSet dataSet = importer.GetData(reader);
            this.radGanttView1.DataSource = dataSet;
</code></pre>

<h4>__[VB.NET] __</h4>

<pre><code>        Dim fileLocation As String = "C:\file.xml"
        Dim importer As New MsProjectImporter()
        Dim reader As New StringReader(fileLocation)
        Dim dataSet As DataSet = importer.GetData(reader)
</code></pre>
        </article>
    </div>	
</div>

<footer>	
    <p><a onclick="javascript:SubmitFeedback('documentation@telerik.com','Telerik UI for WinForms','','','','%0\dYour%20feedback%20is%20used%20to%20improve%20the%20documentation%20and%20the%20product.%20Your%20e-mail%20address%20will%20not%20be%20used%20for%20any%20other%20purpose%20and%20is%20disposed%20of%20after%20the%20issue%20you%20report%20is%20resolved.%20%20While%20working%20to%20resolve%20the%20issue%20that%20you%20report,%20you%20may%20be%20contacted%20via%20e-mail%20to%20get%20further%20details%20or%20clarification%20on%20the%20feedback%20you%20sent.%20After%20the%20issue%20you%20report%20has%20been%20addressed,%20you%20may%20receive%20an%20e-mail%20to%20let%20you%20know%20that%20your%20feedback%20has%20been%20addressed.%0\A%0\d','Customer%20Feedback'); return false;" href="javascript:;" id="send-feedback">Send Feedback</a> Copyright &copy; 2002-<span id="toYear"></span> Telerik. All rights reserved.</p>
</footer>

    </body>
</html>

