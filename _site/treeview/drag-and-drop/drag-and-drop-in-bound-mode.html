<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=9">
        <title>Drag and Drop in bound mode</title>
		
        <link href="/devtools/winforms/favicon.ico?Version=2014" rel="shortcut icon" />
		
        <meta name="description" content="Drag and Drop in bound mode">
        <link href="http://cdn.kendostatic.com/2014.2.716/styles/kendo.common.min.css" rel="stylesheet" />
        <link rel="stylesheet" href="/devtools/winforms/assets/styles-849dcaf701d866988e8c3593f15b66de.css">
        <link rel="stylesheet" href="/devtools/winforms/assets/theme-52ac78f88dc084a004a9f7d63a3c4245.css">
        <link rel="stylesheet" href="/devtools/winforms/assets/branding-fafb6ed99bf90d251675534381e6f139.css">
        <link rel="stylesheet" href="/devtools/winforms/assets/highlight-49ceada082f1c903edb130c25d09cf1f.css">
        <script src="http://code.jquery.com/jquery-1.10.2.js"></script>
        <script src="http://cdn.kendostatic.com/2014.2.716/js/kendo.web.min.js"></script>
        <script src="/devtools/winforms/assets/prettify-31f05a2784b46b14f119862e47123f4c.js"></script>
        <script src="/devtools/winforms/assets/app-6da8e8e1ef6e19ee4a020ec34f48078c.js"></script>
		<script src="/devtools/winforms/assets/prettify-31f05a2784b46b14f119862e47123f4c.js"></script>
        <script src="/devtools/winforms/assets/branding-59377013fb75f02a1dbffd638033ef6d.js"></script>
		<script src="/devtools/winforms/assets/feedback-76cd418a099f8d21592f412fb4a31191.js"></script>
		
		<!--[if lt IE 9]>
		<script>
		document.createElement('header');
		document.createElement('nav');
		document.createElement('section');
		document.createElement('article');
		document.createElement('aside');
		document.createElement('footer');
		document.createElement('hgroup');
		</script>
		<![endif]-->
    </head>
    <body class="faux-columns">
        <!-- Google Tag Manager -->
        <noscript>
            <iframe src="//www.googletagmanager.com/ns.html?id=GTM-6X92" height="0" width="0" style="display: none; visibility: hidden"></iframe>
        </noscript>
        <script>(function(w, d, s, l, i) { w[l] = w[l] || []; w[l].push({ 'gtm.start': new Date().getTime(), event: 'gtm.js' }); var f = d.getElementsByTagName(s)[0], j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : ''; j.async = true; j.src = '//www.googletagmanager.com/gtm.js?id=' + i + dl; f.parentNode.insertBefore(j, f); })(window, document, 'script', 'dataLayer', 'GTM-6X92');</script>
        <!-- End Google Tag Manager -->
        <header id="page-header">
			<span class="toggle-nav"><span></span></span>
            <div id="logo-bar">
	<a href="/devtools/winforms/" title="UI for WinForms">
		<span>UI for WinForms</span>
	</a>
</div> 
<div id="page-search">
	<script>
  (function() {
    var cx = '001595215763381649090:jt1stbj813w';
    var gcse = document.createElement('script');
    gcse.async = true;
    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
        '//www.google.com/cse/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>

</div>

<span class="show-search">
	<span class="k-icon k-i-search"></span>
</span>

<div class="nav-buttons">
	<a href="http://demos.telerik.com/" title="WinForms Demos" target="_blank" class="btn demos-btn">Demos</a>	
	<a href="http://www.telerik.com/products/winforms.aspx" title="About UI for WinForms" target="_blank" class="btn about-btn">About</a>
	<a href="http://www.telerik.com/purchase/individual/winforms.aspx" title="Pricing" target="_blank" class="btn pricing-btn">Pricing</a>
	<a href="http://www.telerik.com/products/winforms/download.aspx" title="Try now" target="_blank" class="btn btn-primary">Try now</a>
</div>





        </header>

        <div id="page-inner-content">
    <div id="page-nav">
        <div id="page-tree"></div>
        <script>
			$("#page-tree").kendoTreeView({
				dataSource: {
					transport: {
						read: {
							url: "/devtools/winforms/default.json",
							dataType: "json"
						}
					},
					schema: {
						model: {
							id: "path",
							children: "items",
							hasChildren: "items"
						}
					}
				},
				select: preventParentSelection,
				template: navigationTemplate("/devtools/winforms/"),
				dataBound: expandNavigation("treeview/drag-and-drop/drag-and-drop-in-bound-mode.html")
			});
        </script>
		<div id="page-api" class="k-treeview">
			<ul class="k-group">
				<li class="k-item">
					<span class="k-icon k-plus" role="presentation"></span>
					<span class="k-in">
						<a href="/devtools/winforms/api/" target="_blank">API Reference</a>
					</span>
				</li>
			</ul>
		</div>			
    </div>
	<a id="page-edit-link" class="btn btn-action" href="https://github.com/telerik/xaml-docs/edit/master/treeview/drag-and-drop/drag-and-drop-in-bound-mode.md">Edit this page</a>
    <div id="page-article">       
        <article>
            <h1 id="drag-and-drop-in-bound-mode"><a href="#drag-and-drop-in-bound-mode">Drag and Drop in bound mode</a></h1>

<p>When the <strong>RadTreeView</strong> is in bound mode, it supports drag and drop behavior. In order to enable this functionality, <br>
      you should set the <strong>AllowDragDrop</strong> property to <em>true</em>. However, due to the specificity of <br>
      the <strong>RadTreeView</strong>â€™s <a href="/devtools/winforms/treeview/data-binding/data-binding-basics">data binding</a> <br>
      and the set up hierarchical data structure, it is necessary to handle manually the drag and drop operation to obtain correct nodes order. <br>
      For this purpose, it is necessary to create a custom <strong>TreeViewDragDropService</strong>. This article demonstrates a sample approach how to achieve it.<img src="images/treeview-drag-and-drop-drag-and-drop-in-bound-mode001.gif" alt="treeview-drag-and-drop-drag-and-drop-in-bound-mode 001"></p>

<ol>
<li>Consider the <strong>RadTreeView</strong> is bound to the following <a href="/devtools/winforms/treeview/data-binding/binding-to-self-referencing-data">
          self-referencing data</a>.</li>
</ol>

<h4><strong>[C#]</strong></h4>

<pre><code>        protected void BindRadTreeView()
        {
            DataTable dt = new DataTable();
            dt.Columns.Add("Id", typeof(string));
            dt.Columns.Add("Title", typeof(string));
            dt.Columns.Add("ParentId", typeof(string));

            string parentId = string.Empty;
            string childId = string.Empty;
            for (int i = 0; i &lt; 3; i++)
            {
                parentId = Guid.NewGuid().ToString();
                dt.Rows.Add(parentId, "Node" + i, null);
                for (int j = 0; j &lt; 5; j++)
                {
                    childId = Guid.NewGuid().ToString();
                    dt.Rows.Add(childId, "SubNode" + i + "." + j, parentId);
                }
            }

            this.radTreeView1.ChildMember = "Id";
            this.radTreeView1.ParentMember = "ParentId";
            this.radTreeView1.DisplayMember = "Title";
            this.radTreeView1.DataSource = dt;
        }
</code></pre>

<h4><strong>[VB.NET]</strong></h4>

<pre><code>    Protected Sub BindRadTreeView()
        Dim dt As New DataTable()
        dt.Columns.Add("Id", GetType(String))
        dt.Columns.Add("Title", GetType(String))
        dt.Columns.Add("ParentId", GetType(String))

        Dim parentId As String = String.Empty
        Dim childId As String = String.Empty
        For i As Integer = 0 To 2
            parentId = Guid.NewGuid().ToString()
            dt.Rows.Add(parentId, "Node" &amp; i, Nothing)
            For j As Integer = 0 To 4
                childId = Guid.NewGuid().ToString()
                dt.Rows.Add(childId, "SubNode" &amp; i &amp; "." &amp; j, parentId)
            Next
        Next

        Me.radTreeView1.ChildMember = "Id"
        Me.radTreeView1.ParentMember = "ParentId"
        Me.radTreeView1.DisplayMember = "Title"
        Me.radTreeView1.DataSource = dt
    End Sub

#End Region

#Region "CustomService"

    Private Class CustomDragDropService
        Inherits TreeViewDragDropService
        Private owner As RadTreeViewElement
        Private draggedNodes As List(Of RadTreeNode)

        Public Sub New(owner As RadTreeViewElement)
            MyBase.New(owner)
            Me.owner = owner
        End Sub

        'Save the dragged nodes
        Protected Overrides Sub PerformStart()
            MyBase.PerformStart()

            draggedNodes = New List(Of RadTreeNode)()
            For Each selectedNode As RadTreeNode In Me.owner.SelectedNodes
                draggedNodes.Add(selectedNode)
            Next
        End Sub

        'Clean the saved nodes
        Protected Overrides Sub PerformStop()
            MyBase.PerformStop()
            draggedNodes.Clear()
        End Sub

        'If tree element or node element is hovered, allow drop
        Protected Overrides Sub OnPreviewDragOver(e As RadDragOverEventArgs)
            MyBase.OnPreviewDragOver(e)

            Dim targetElement As RadTreeViewElement = TryCast(e.HitTarget, RadTreeViewElement)
            If targetElement IsNot Nothing AndAlso targetElement.Equals(Me.owner) Then
                e.CanDrop = True
            ElseIf TypeOf e.HitTarget Is TreeNodeElement Then
                e.CanDrop = True

                For Each draggedNode As RadTreeNode In draggedNodes
                    Dim targetNode As RadTreeNode = TryCast(e.HitTarget, TreeNodeElement).Data.Parent
                    If draggedNode.Equals(targetNode) Then
                        'prevent dragging of a parent node over some of its child nodes
                        e.CanDrop = False
                        Exit For
                    End If
                Next
            End If
        End Sub

        'Create copies of the selected node(s) and add them to the hovered node/tree
        Protected Overrides Sub OnPreviewDragDrop(e As RadDropEventArgs)
            Dim targetNodeElement As TreeNodeElement = TryCast(e.HitTarget, TreeNodeElement)
            Dim targetTreeView As RadTreeViewElement = If(targetNodeElement Is Nothing, TryCast(e.HitTarget, RadTreeViewElement), targetNodeElement.TreeViewElement)

            If targetTreeView Is Nothing Then
                Return
            End If

            targetTreeView.BeginUpdate()

            For Each node As RadTreeNode In draggedNodes
                Dim rowView As DataRowView = TryCast(node.DataBoundItem, DataRowView)
                Dim row As DataRow = rowView.Row
                Dim dt As DataTable = TryCast(targetTreeView.DataSource, DataTable)
                If dt Is Nothing Then
                    Return
                End If

                'save expanded state and vertical scrollbar value                   

                If targetNodeElement IsNot Nothing Then
                    If CanShowDropHint(Cursor.Position, targetNodeElement) Then
                        'change node' parent
                        Dim nodeOver As RadTreeNode = targetNodeElement.Data.Parent

                        If nodeOver Is Nothing Then
                            nodeOver = targetNodeElement.Data
                        End If

                        Dim targetRowView As DataRowView = DirectCast(nodeOver.DataBoundItem, DataRowView)
                        Dim targetRow As DataRow = targetRowView.Row
                        If Not row("ParentId").Equals(targetRow("ParentId")) Then
                            row("ParentId") = targetRow("Id")
                        End If

                        Dim rowToInsert As DataRow = dt.NewRow()
                        rowToInsert("ParentId") = row("ParentId")
                        rowToInsert("Id") = row("Id")
                        rowToInsert("Title") = row("Title")
                        dt.Rows.Remove(row)
                        Dim targetIndex As Integer = GetTargetIndex(dt, targetNodeElement)

                        Dim position As DropPosition = Me.GetDropPosition(e.DropLocation, targetNodeElement)
                        If position = DropPosition.AfterNode Then
                            targetIndex += 1
                        End If
                        dt.Rows.InsertAt(rowToInsert, targetIndex)
                    Else
                        Dim nodeOver As RadTreeNode = targetNodeElement.Data
                        Dim targetRowView As DataRowView = DirectCast(nodeOver.DataBoundItem, DataRowView)
                        Dim targetRow As DataRow = targetRowView.Row
                        row("ParentId") = targetRow("Id")
                    End If
                Else
                    'make the node "root node"
                    row("ParentId") = Nothing
                End If

                Dim ds As Object = targetTreeView.DataSource
                targetTreeView.DataSource = Nothing
                targetTreeView.DataSource = ds


                'restore expanded state and vertical scrollbar value
                targetTreeView.Update(RadTreeViewElement.UpdateActions.ItemAdded)
            Next
            targetTreeView.EndUpdate()
        End Sub

        Private Function GetTargetIndex(dt As DataTable, targetNodeElement As TreeNodeElement) As Integer
            Dim index As Integer = 0
            Dim targetRowView As DataRowView = DirectCast(targetNodeElement.Data.DataBoundItem, DataRowView)
            Dim targetRow As DataRow = targetRowView.Row
            index = dt.Rows.IndexOf(targetRow)

            Return index
        End Function

        Private Function CanShowDropHint(point As Point, nodeElement As TreeNodeElement) As Boolean
            If nodeElement Is Nothing Then
                Return False
            End If

            Dim client As Point = nodeElement.PointFromScreen(point)
            Dim part As Integer = nodeElement.Size.Height / 3
            Return client.Y &lt; part OrElse client.Y &gt; part * 2
        End Function
    End Class

#End Region

#Region "CustomTreeViewElement"

    Private Class CustomTreeViewElement
        Inherits RadTreeViewElement
        Protected Overrides ReadOnly Property ThemeEffectiveType() As Type
            Get
                Return GetType(RadTreeViewElement)
            End Get
        End Property

        Protected Overrides Function CreateDragDropService() As TreeViewDragDropService
            Return New CustomDragDropService(Me)
        End Function
    End Class

#End Region

#Region "TreeView"

    Private Class CustomTreeView
        Inherits RadTreeView
        Protected Overrides Function CreateTreeViewElement() As RadTreeViewElement
            Return New CustomTreeViewElement()
        End Function

        Public Overrides Property ThemeClassName() As String
            Get
                Return GetType(RadTreeView).FullName
            End Get
            Set(value As String)
                MyBase.ThemeClassName = value
            End Set
        End Property
    End Class

#End Region

End Class
</code></pre>

<ol>
<li><p>Enable multiple <a href="/devtools/winforms/treeview/working-with-nodes/selecting-nodes">selection</a> <br>
        by setting the <strong>MultiSelect</strong>  property to <em>true</em>.</p></li>
<li><p>Create a derivative of the <strong>TreeViewDragDropService</strong> which should perform the desired drag and drop functionality. <br>
        The <strong>OnPreviewDragOver</strong> method allows you to control on what targets the nodes, being dragged, can be dropped on. <br>
        The <strong>OnPreviewDragDrop</strong> method initiates the actual physical move of the nodes from one position to another.</p></li>
</ol>

<h4><strong>[C#]</strong></h4>

<pre><code>        class CustomDragDropService : TreeViewDragDropService
        {
            private RadTreeViewElement owner;
            private List&lt;RadTreeNode&gt; draggedNodes;

            public CustomDragDropService(RadTreeViewElement owner) : base(owner)
            {
                this.owner = owner;
            }

            //Save the dragged nodes
            protected override void PerformStart()
            {
                base.PerformStart();

                draggedNodes = new List&lt;RadTreeNode&gt;();
                foreach (RadTreeNode selectedNode in this.owner.SelectedNodes)
                {
                    draggedNodes.Add(selectedNode);
                }
            }

            //Clean the saved nodes
            protected override void PerformStop()
            {
                base.PerformStop();
                draggedNodes.Clear();
            }

            //If tree element or node element is hovered, allow drop
            protected override void OnPreviewDragOver(RadDragOverEventArgs e)
            {
                base.OnPreviewDragOver(e);

                RadTreeViewElement targetElement = e.HitTarget as RadTreeViewElement;
                if (targetElement != null &amp;&amp; targetElement.Equals(this.owner))
                {
                    e.CanDrop = true;
                }
                else if (e.HitTarget is TreeNodeElement)
                {
                    e.CanDrop = true;

                    foreach (RadTreeNode draggedNode in draggedNodes)
                    {
                        RadTreeNode targetNode = (e.HitTarget as TreeNodeElement).Data.Parent;
                        if (draggedNode == targetNode)
                        {
                            //prevent dragging of a parent node over some of its child nodes
                            e.CanDrop = false;
                            break;
                        }
                    }
                }
            }

            //Create copies of the selected node(s) and add them to the hovered node/tree
            protected override void OnPreviewDragDrop(RadDropEventArgs e)
            {
                TreeNodeElement targetNodeElement = e.HitTarget as TreeNodeElement;
                RadTreeViewElement targetTreeView = targetNodeElement == null ? e.HitTarget as RadTreeViewElement
                                                    : targetNodeElement.TreeViewElement;

                if (targetTreeView == null)
                {
                    return;
                }

                targetTreeView.BeginUpdate();

                foreach (RadTreeNode node in draggedNodes)
                {
                    DataRowView rowView = node.DataBoundItem as DataRowView;
                    DataRow row = rowView.Row;
                    DataTable dt = targetTreeView.DataSource as DataTable;
                    if (dt == null)
                    {
                        return;                        
                    }

                    //save expanded state and vertical scrollbar value                   

                    if (targetNodeElement != null)
                    {
                        if (CanShowDropHint(Cursor.Position, targetNodeElement))
                        {
                            //change node' parent
                            RadTreeNode nodeOver = targetNodeElement.Data.Parent;

                            if (nodeOver == null)
                            {
                                nodeOver = targetNodeElement.Data;
                            }

                            DataRowView targetRowView = (DataRowView)nodeOver.DataBoundItem;
                            DataRow targetRow = targetRowView.Row;
                            if (row["ParentId"] != targetRow["ParentId"])
                            {
                                row["ParentId"] = targetRow["Id"];
                            }

                            DataRow rowToInsert = dt.NewRow();
                            rowToInsert["ParentId"] = row["ParentId"];
                            rowToInsert["Id"] = row["Id"];
                            rowToInsert["Title"] = row["Title"];
                            dt.Rows.Remove(row);
                            int targetIndex = GetTargetIndex(dt, targetNodeElement);

                            DropPosition position = this.GetDropPosition(e.DropLocation, targetNodeElement);
                            if (position == DropPosition.AfterNode)
                            {
                                targetIndex++;
                            }
                            dt.Rows.InsertAt(rowToInsert, targetIndex);
                        }
                        else
                        {
                            RadTreeNode nodeOver = targetNodeElement.Data;
                            DataRowView targetRowView = (DataRowView)nodeOver.DataBoundItem;
                            DataRow targetRow = targetRowView.Row;
                            row["ParentId"] = targetRow["Id"];
                        }
                    }
                    else
                    {
                        //make the node "root node"
                        row["ParentId"] = null;
                    }

                    object ds = targetTreeView.DataSource;
                    targetTreeView.DataSource = null;
                    targetTreeView.DataSource = ds;

                    targetTreeView.Update(RadTreeViewElement.UpdateActions.ItemAdded);
                    //restore expanded state and vertical scrollbar value
                }
                targetTreeView.EndUpdate();
            }

            private int GetTargetIndex(DataTable dt, TreeNodeElement targetNodeElement)
            {
                int index = 0;
                DataRowView targetRowView = (DataRowView)targetNodeElement.Data.DataBoundItem;
                DataRow targetRow = targetRowView.Row;
                index = dt.Rows.IndexOf(targetRow);

                return index;
            }

            private bool CanShowDropHint(Point point, TreeNodeElement nodeElement)
            {
                if (nodeElement == null)
                {
                    return false;
                }

                Point client = nodeElement.PointFromScreen(point);
                int part = nodeElement.Size.Height / 3;
                return client.Y &lt; part || client.Y &gt; part * 2;
            }
        }
</code></pre>

<h4><strong>[VB.NET]</strong></h4>

<pre><code>    Private Class CustomDragDropService
        Inherits TreeViewDragDropService
        Private owner As RadTreeViewElement
        Private draggedNodes As List(Of RadTreeNode)

        Public Sub New(owner As RadTreeViewElement)
            MyBase.New(owner)
            Me.owner = owner
        End Sub

        'Save the dragged nodes
        Protected Overrides Sub PerformStart()
            MyBase.PerformStart()

            draggedNodes = New List(Of RadTreeNode)()
            For Each selectedNode As RadTreeNode In Me.owner.SelectedNodes
                draggedNodes.Add(selectedNode)
            Next
        End Sub

        'Clean the saved nodes
        Protected Overrides Sub PerformStop()
            MyBase.PerformStop()
            draggedNodes.Clear()
        End Sub

        'If tree element or node element is hovered, allow drop
        Protected Overrides Sub OnPreviewDragOver(e As RadDragOverEventArgs)
            MyBase.OnPreviewDragOver(e)

            Dim targetElement As RadTreeViewElement = TryCast(e.HitTarget, RadTreeViewElement)
            If targetElement IsNot Nothing AndAlso targetElement.Equals(Me.owner) Then
                e.CanDrop = True
            ElseIf TypeOf e.HitTarget Is TreeNodeElement Then
                e.CanDrop = True

                For Each draggedNode As RadTreeNode In draggedNodes
                    Dim targetNode As RadTreeNode = TryCast(e.HitTarget, TreeNodeElement).Data.Parent
                    If draggedNode.Equals(targetNode) Then
                        'prevent dragging of a parent node over some of its child nodes
                        e.CanDrop = False
                        Exit For
                    End If
                Next
            End If
        End Sub

        'Create copies of the selected node(s) and add them to the hovered node/tree
        Protected Overrides Sub OnPreviewDragDrop(e As RadDropEventArgs)
            Dim targetNodeElement As TreeNodeElement = TryCast(e.HitTarget, TreeNodeElement)
            Dim targetTreeView As RadTreeViewElement = If(targetNodeElement Is Nothing, TryCast(e.HitTarget, RadTreeViewElement), targetNodeElement.TreeViewElement)

            If targetTreeView Is Nothing Then
                Return
            End If

            targetTreeView.BeginUpdate()

            For Each node As RadTreeNode In draggedNodes
                Dim rowView As DataRowView = TryCast(node.DataBoundItem, DataRowView)
                Dim row As DataRow = rowView.Row
                Dim dt As DataTable = TryCast(targetTreeView.DataSource, DataTable)
                If dt Is Nothing Then
                    Return
                End If

                'save expanded state and vertical scrollbar value                   

                If targetNodeElement IsNot Nothing Then
                    If CanShowDropHint(Cursor.Position, targetNodeElement) Then
                        'change node' parent
                        Dim nodeOver As RadTreeNode = targetNodeElement.Data.Parent

                        If nodeOver Is Nothing Then
                            nodeOver = targetNodeElement.Data
                        End If

                        Dim targetRowView As DataRowView = DirectCast(nodeOver.DataBoundItem, DataRowView)
                        Dim targetRow As DataRow = targetRowView.Row
                        If Not row("ParentId").Equals(targetRow("ParentId")) Then
                            row("ParentId") = targetRow("Id")
                        End If

                        Dim rowToInsert As DataRow = dt.NewRow()
                        rowToInsert("ParentId") = row("ParentId")
                        rowToInsert("Id") = row("Id")
                        rowToInsert("Title") = row("Title")
                        dt.Rows.Remove(row)
                        Dim targetIndex As Integer = GetTargetIndex(dt, targetNodeElement)

                        Dim position As DropPosition = Me.GetDropPosition(e.DropLocation, targetNodeElement)
                        If position = DropPosition.AfterNode Then
                            targetIndex += 1
                        End If
                        dt.Rows.InsertAt(rowToInsert, targetIndex)
                    Else
                        Dim nodeOver As RadTreeNode = targetNodeElement.Data
                        Dim targetRowView As DataRowView = DirectCast(nodeOver.DataBoundItem, DataRowView)
                        Dim targetRow As DataRow = targetRowView.Row
                        row("ParentId") = targetRow("Id")
                    End If
                Else
                    'make the node "root node"
                    row("ParentId") = Nothing
                End If

                Dim ds As Object = targetTreeView.DataSource
                targetTreeView.DataSource = Nothing
                targetTreeView.DataSource = ds


                'restore expanded state and vertical scrollbar value
                targetTreeView.Update(RadTreeViewElement.UpdateActions.ItemAdded)
            Next
            targetTreeView.EndUpdate()
        End Sub

        Private Function GetTargetIndex(dt As DataTable, targetNodeElement As TreeNodeElement) As Integer
            Dim index As Integer = 0
            Dim targetRowView As DataRowView = DirectCast(targetNodeElement.Data.DataBoundItem, DataRowView)
            Dim targetRow As DataRow = targetRowView.Row
            index = dt.Rows.IndexOf(targetRow)

            Return index
        End Function

        Private Function CanShowDropHint(point As Point, nodeElement As TreeNodeElement) As Boolean
            If nodeElement Is Nothing Then
                Return False
            End If

            Dim client As Point = nodeElement.PointFromScreen(point)
            Dim part As Integer = nodeElement.Size.Height / 3
            Return client.Y &lt; part OrElse client.Y &gt; part * 2
        End Function
    End Class

#End Region

#Region "CustomTreeViewElement"

    Private Class CustomTreeViewElement
        Inherits RadTreeViewElement
        Protected Overrides ReadOnly Property ThemeEffectiveType() As Type
            Get
                Return GetType(RadTreeViewElement)
            End Get
        End Property

        Protected Overrides Function CreateDragDropService() As TreeViewDragDropService
            Return New CustomDragDropService(Me)
        End Function
    End Class

#End Region

#Region "TreeView"

    Private Class CustomTreeView
        Inherits RadTreeView
        Protected Overrides Function CreateTreeViewElement() As RadTreeViewElement
            Return New CustomTreeViewElement()
        End Function

        Public Overrides Property ThemeClassName() As String
            Get
                Return GetType(RadTreeView).FullName
            End Get
            Set(value As String)
                MyBase.ThemeClassName = value
            End Set
        End Property
    End Class

#End Region

End Class
</code></pre>

<ol>
<li>The custom <strong>TreeViewDragDropService</strong> is ready. Now, we need to replace the default one. 
        For this purpose, it is necessary to create a derivative of the <strong>RadTreeViewElement</strong> and override the <strong>CreateDragDropService</strong> method. </li>
</ol>

<h4><strong>[C#]</strong></h4>

<pre><code>        class CustomTreeViewElement : RadTreeViewElement
        {
            protected override Type ThemeEffectiveType
            {
                get
                {
                    return typeof(RadTreeViewElement);
                }
            }

            protected override TreeViewDragDropService CreateDragDropService()
            {
                return new CustomDragDropService(this);
            }
        }
</code></pre>

<h4><strong>[VB.NET]</strong></h4>

<pre><code>    Private Class CustomTreeViewElement
        Inherits RadTreeViewElement
        Protected Overrides ReadOnly Property ThemeEffectiveType() As Type
            Get
                Return GetType(RadTreeViewElement)
            End Get
        End Property

        Protected Overrides Function CreateDragDropService() As TreeViewDragDropService
            Return New CustomDragDropService(Me)
        End Function
    End Class

#End Region

#Region "TreeView"

    Private Class CustomTreeView
        Inherits RadTreeView
        Protected Overrides Function CreateTreeViewElement() As RadTreeViewElement
            Return New CustomTreeViewElement()
        End Function

        Public Overrides Property ThemeClassName() As String
            Get
                Return GetType(RadTreeView).FullName
            End Get
            Set(value As String)
                MyBase.ThemeClassName = value
            End Set
        End Property
    End Class

#End Region

End Class
</code></pre>

<ol>
<li>Finally, replace the default <strong>RadTreeViewElement</strong> in the tree with the custom one.</li>
</ol>

<h4><strong>[C#]</strong></h4>

<pre><code>        class CustomTreeView : RadTreeView
        {
            protected override RadTreeViewElement CreateTreeViewElement()
            {
                return new CustomTreeViewElement();
            }

            public override string ThemeClassName
            {
                get
                {
                    return typeof(RadTreeView).FullName;
                }
                set
                {
                    base.ThemeClassName = value;
                }
            }
        }
</code></pre>

<h4><strong>[VB.NET]</strong></h4>

<pre><code>    Private Class CustomTreeView
        Inherits RadTreeView
        Protected Overrides Function CreateTreeViewElement() As RadTreeViewElement
            Return New CustomTreeViewElement()
        End Function

        Public Overrides Property ThemeClassName() As String
            Get
                Return GetType(RadTreeView).FullName
            End Get
            Set(value As String)
                MyBase.ThemeClassName = value
            End Set
        End Property
    End Class

#End Region

End Class
</code></pre>
        </article>
    </div>	
</div>

<footer>	
    <p><a onclick="javascript:SubmitFeedback('documentation@telerik.com','Telerik UI for WinForms','','','','%0\dYour%20feedback%20is%20used%20to%20improve%20the%20documentation%20and%20the%20product.%20Your%20e-mail%20address%20will%20not%20be%20used%20for%20any%20other%20purpose%20and%20is%20disposed%20of%20after%20the%20issue%20you%20report%20is%20resolved.%20%20While%20working%20to%20resolve%20the%20issue%20that%20you%20report,%20you%20may%20be%20contacted%20via%20e-mail%20to%20get%20further%20details%20or%20clarification%20on%20the%20feedback%20you%20sent.%20After%20the%20issue%20you%20report%20has%20been%20addressed,%20you%20may%20receive%20an%20e-mail%20to%20let%20you%20know%20that%20your%20feedback%20has%20been%20addressed.%0\A%0\d','Customer%20Feedback'); return false;" href="javascript:;" id="send-feedback">Send Feedback</a> Copyright &copy; 2002-<span id="toYear"></span> Telerik. All rights reserved.</p>
</footer>

    </body>
</html>

