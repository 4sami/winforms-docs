<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=9">
        <title>Modify the DragDropService behavior</title>
		
        <link href="/devtools/winforms/favicon.ico?Version=2014" rel="shortcut icon" />
		
        <meta name="description" content="Modify the DragDropService behavior">
        <link href="http://cdn.kendostatic.com/2014.2.716/styles/kendo.common.min.css" rel="stylesheet" />
        <link rel="stylesheet" href="/devtools/winforms/assets/styles-0b5a71aa940403cb3ac60d7e91e25e1d.css">
        <link rel="stylesheet" href="/devtools/winforms/assets/theme-52ac78f88dc084a004a9f7d63a3c4245.css">
        <link rel="stylesheet" href="/devtools/winforms/assets/branding-fafb6ed99bf90d251675534381e6f139.css">
        <link rel="stylesheet" href="/devtools/winforms/assets/highlight-49ceada082f1c903edb130c25d09cf1f.css">
        <script src="http://code.jquery.com/jquery-1.10.2.js"></script>
        <script src="http://cdn.kendostatic.com/2014.2.716/js/kendo.web.min.js"></script>
        <script src="/devtools/winforms/assets/prettify-31f05a2784b46b14f119862e47123f4c.js"></script>
        <script src="/devtools/winforms/assets/app-6da8e8e1ef6e19ee4a020ec34f48078c.js"></script>
		<script src="/devtools/winforms/assets/prettify-31f05a2784b46b14f119862e47123f4c.js"></script>
        <script src="/devtools/winforms/assets/branding-59377013fb75f02a1dbffd638033ef6d.js"></script>
		<script src="/devtools/winforms/assets/feedback-76cd418a099f8d21592f412fb4a31191.js"></script>
		
		<!--[if lt IE 9]>
		<script>
		document.createElement('header');
		document.createElement('nav');
		document.createElement('section');
		document.createElement('article');
		document.createElement('aside');
		document.createElement('footer');
		document.createElement('hgroup');
		</script>
		<![endif]-->
    </head>
    <body class="faux-columns">
        <!-- Google Tag Manager -->
        <noscript>
            <iframe src="//www.googletagmanager.com/ns.html?id=GTM-6X92" height="0" width="0" style="display: none; visibility: hidden"></iframe>
        </noscript>
        <script>(function(w, d, s, l, i) { w[l] = w[l] || []; w[l].push({ 'gtm.start': new Date().getTime(), event: 'gtm.js' }); var f = d.getElementsByTagName(s)[0], j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : ''; j.async = true; j.src = '//www.googletagmanager.com/gtm.js?id=' + i + dl; f.parentNode.insertBefore(j, f); })(window, document, 'script', 'dataLayer', 'GTM-6X92');</script>
        <!-- End Google Tag Manager -->
        <header id="page-header">
			<span class="toggle-nav"><span></span></span>
            <div id="logo-bar">
	<a href="/devtools/winforms/" title="UI for WinForms">
		<span>UI for WinForms</span>
	</a>
</div> 
<div id="page-search">
	<script>
  (function() {
    var cx = '001595215763381649090:jt1stbj813w';
    var gcse = document.createElement('script');
    gcse.async = true;
    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
        '//www.google.com/cse/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>

</div>

<span class="show-search">
	<span class="k-icon k-i-search"></span>
</span>

<div class="nav-buttons">
	<a href="http://demos.telerik.com/wpf/" title="WPF Demos" target="_blank" class="btn demos-btn">Demos</a>	
	<a href="http://www.telerik.com/products/wpf/overview.aspx" title="About UI for WPF" target="_blank" class="btn about-btn">About</a>
	<a href="http://www.telerik.com/purchase/individual/wpf.aspx" title="Pricing" target="_blank" class="btn pricing-btn">Pricing</a>
	<a href="http://www.telerik.com/products/wpf/download.aspx" title="Try now" target="_blank" class="btn btn-primary">Try now</a>
</div>





        </header>

        <div id="page-inner-content">
    <div id="page-nav">
        <div id="page-tree"></div>
        <script>
			$("#page-tree").kendoTreeView({
				dataSource: {
					transport: {
						read: {
							url: "/devtools/winforms/default.json",
							dataType: "json"
						}
					},
					schema: {
						model: {
							id: "path",
							children: "items",
							hasChildren: "items"
						}
					}
				},
				select: preventParentSelection,
				template: navigationTemplate("/devtools/winforms/"),
				dataBound: expandNavigation("treeview/drag-and-drop/modify-the-drag-drop-service-behavior.html")
			});
        </script>
		<div id="page-api" class="k-treeview">
			<ul class="k-group">
				<li class="k-item">
					<span class="k-icon k-plus" role="presentation"></span>
					<span class="k-in">
						<a href="/devtools/winforms/api/" target="_blank">API Reference</a>
					</span>
				</li>
			</ul>
		</div>			
    </div>
	<a id="page-edit-link" class="btn btn-action" href="https://github.com/telerik/xaml-docs/edit/master/treeview/drag-and-drop/modify-the-drag-drop-service-behavior.md">Edit this page</a>
    <div id="page-article">       
        <article>
            <h1 id="modify-the-dragdropservice-behavior"><a href="#modify-the-dragdropservice-behavior">Modify the DragDropService behavior</a></h1>

<p>This article demonstrates how to customize the TreeViewDragDropService behavior and more precisely <br>
        how to customize it to copy the nodes when dropped, instead of moving them.<br>
      <img src="images/treeview-drag-and-drop-modify-the-drag-drop-service-behavior001.gif" alt="treeview-drag-and-drop-modify-the-drag-drop-service-behavior 001"></p>

<p>To achieve this scenario we will need to create a descendant of TreeViewDragDropService (lets call it CustomDragDropService)<br>
          where we will expose the RadTreeViewElement as a field, so we can use it later. This field will be assigned in the CustomDragDropService class constructor.<br>
          We will also need another field of type RadTreeNode which will hold the dragged node. The latter will be assigned in the PerformStart method and will be cleared in the PerformStop method.</p>

<p>Next we need to override the OnPreviewDragOver method, where we will specify upon what conditions a drop will be allowed and finally, in the OnPreviewDragDrop override, we will add the logic for copying the selected nodes instead of moving them:</p>

<h4>__[C#] __</h4>

<pre><code>    class CustomDragDropService : TreeViewDragDropService
    {
        RadTreeViewElement owner;
        RadTreeNode draggedNode;

        //Initialize the service
        public CustomDragDropService(RadTreeViewElement owner)
            : base(owner)
        {
            this.owner = owner;
        }

        //Save the dragged node
        protected override void PerformStart()
        {
            base.PerformStart();

            TreeNodeElement draggedNodeElement = this.Context as TreeNodeElement;
            this.draggedNode = draggedNodeElement.Data;
        }

        //Clean the saved node
        protected override void PerformStop()
        {
            base.PerformStop();
            this.draggedNode = null;
        }

        //If tree element is hovered, allow drop
        protected override void OnPreviewDragOver(RadDragOverEventArgs e)
        {
            base.OnPreviewDragOver(e);

            RadTreeViewElement targetElement = e.HitTarget as RadTreeViewElement;
            if (targetElement != null &amp;&amp; targetElement != this.owner)
            {
                e.CanDrop = true;
            }
        }

        //Create copies of the selected node(s) and add them to the hovered node/tree
        protected override void OnPreviewDragDrop(RadDropEventArgs e)
        {
            TreeNodeElement targetNodeElement = e.HitTarget as TreeNodeElement;
            RadTreeViewElement targetTreeView = targetNodeElement == null ? e.HitTarget as RadTreeViewElement : targetNodeElement.TreeViewElement;

            if (targetTreeView == this.owner)
            {
                base.OnPreviewDragDrop(e);
                return;
            }

            if (targetTreeView == null)
            {
                return;
            }

            List&lt;RadTreeNode&gt; draggedNodes = this.GetDraggedNodes(draggedNode);

            targetTreeView.BeginUpdate();
            this.owner.BeginUpdate();

            bool copyNodes = this.IsCopyingNodes;

            foreach (RadTreeNode node in draggedNodes)
            {
                RadTreeNode newNode = CreateNewTreeNode(node);
                if (targetNodeElement != null)
                {
                    targetNodeElement.Data.Nodes.Add(newNode);
                }
                else
                {
                    targetTreeView.Nodes.Add(newNode);
                }
            }

            this.owner.EndUpdate();
            targetTreeView.EndUpdate();
        }

        //Return a copy of a node
        protected virtual RadTreeNode CreateNewTreeNode(RadTreeNode node)
        {
            return node.Clone() as RadTreeNode;
        }
    }
</code></pre>

<h4>__[VB.NET] __</h4>

<pre><code>    Class CustomDragDropService
        Inherits TreeViewDragDropService
        Private owner As RadTreeViewElement
        Private draggedNode As RadTreeNode

        'Initialize the service
        Public Sub New(ByVal owner As RadTreeViewElement)
            MyBase.New(owner)
            Me.owner = owner
        End Sub

        'Save the dragged node
        Protected Overrides Sub PerformStart()
            MyBase.PerformStart()

            Dim draggedNodeElement As TreeNodeElement = TryCast(Me.Context, TreeNodeElement)
            Me.draggedNode = draggedNodeElement.Data
        End Sub

        'Clean the saved node
        Protected Overrides Sub PerformStop()
            MyBase.PerformStop()
            Me.draggedNode = Nothing
        End Sub

        'If tree element is hovered, allow drop
        Protected Overrides Sub OnPreviewDragOver(ByVal e As RadDragOverEventArgs)
            MyBase.OnPreviewDragOver(e)

            Dim targetElement As RadTreeViewElement = TryCast(e.HitTarget, RadTreeViewElement)
            If Not targetElement Is Nothing AndAlso Not targetElement Is Me.owner Then
                e.CanDrop = True
            End If
        End Sub

        'Create copies of the selected node(s) and add them to the hovered node/tree
        Protected Overrides Sub OnPreviewDragDrop(ByVal e As RadDropEventArgs)
            Dim targetNodeElement As TreeNodeElement = TryCast(e.HitTarget, TreeNodeElement)
            Dim targetTreeView As RadTreeViewElement
            If targetNodeElement Is Nothing Then
                targetTreeView = TryCast(e.HitTarget, RadTreeViewElement)
            Else
                targetTreeView = targetNodeElement.TreeViewElement
            End If

            If targetTreeView Is Me.owner Then
                MyBase.OnPreviewDragDrop(e)
                Return
            End If

            If targetTreeView Is Nothing Then
                Return
            End If

            Dim draggedNodes As List(Of RadTreeNode) = Me.GetDraggedNodes(draggedNode)

            targetTreeView.BeginUpdate()
            Me.owner.BeginUpdate()

            Dim copyNodes As Boolean = Me.IsCopyingNodes

            For Each node As RadTreeNode In draggedNodes
                Dim newNode As RadTreeNode = CreateNewTreeNode(node)
                If Not targetNodeElement Is Nothing Then
                    targetNodeElement.Data.Nodes.Add(newNode)
                Else
                    targetTreeView.Nodes.Add(newNode)
                End If
            Next node

            Me.owner.EndUpdate()
            targetTreeView.EndUpdate()
        End Sub

        'Return a copy of a node
        Protected Overridable Function CreateNewTreeNode(ByVal node As RadTreeNode) As RadTreeNode
            Return TryCast(node.Clone(), RadTreeNode)
        End Function
    End Class
</code></pre>

<p>After the custom drag and drop behavior is created, we need to replace the default one. This can be achieved in the CreateDragDropService method of RadTreeViewElement, so we create a new element for the purpose:</p>

<h4>__[C#] __</h4>

<pre><code>    class CustomTreeViewElement : RadTreeViewElement
    {
        //Enable themeing for the element
        protected override Type ThemeEffectiveType
        {
            get
            {
                return typeof(RadTreeViewElement);
            }
        }

        //Replace the default drag drop service with the custom one
        protected override TreeViewDragDropService CreateDragDropService()
        {
            return new CustomDragDropService(this);
        }
    }
</code></pre>

<h4>__[VB.NET] __</h4>

<pre><code>    Class CustomTreeViewElement
        Inherits RadTreeViewElement
        'Enable themeing for the element
        Protected Overrides ReadOnly Property ThemeEffectiveType() As Type
            Get
                Return GetType(RadTreeViewElement)
            End Get
        End Property

        'Replace the default drag drop service with the custom one
        Protected Overrides Function CreateDragDropService() As TreeViewDragDropService
            Return New CustomDragDropService(Me)
        End Function
    End Class
</code></pre>

<p>Now we need to use this CustomTreeViewElement in the tree. To do that we need to pass a new instance of this element in the CreateTreeViewElement of RadTreeView decendant:</p>

<h4>__[C#] __</h4>

<pre><code>    class CustomTreeView : RadTreeView
    {
        //Replace the default element with the custom one
        protected override RadTreeViewElement CreateTreeViewElement()
        {
            return new CustomTreeViewElement();
        }

        //Enable theming for the control
        public override string ThemeClassName
        {
            get
            {
                return typeof(RadTreeView).FullName;
            }
        }
    }
</code></pre>

<h4>__[VB.NET] __</h4>

<pre><code>    Class CustomTreeView
        Inherits RadTreeView
        'Replace the default element with the custom one
        Protected Overrides Function CreateTreeViewElement() As RadTreeViewElement
            Return New CustomTreeViewElement()
        End Function

        'Enable theming for the control
        Public Overrides Property ThemeClassName As String
            Get
                Return GetType(RadTreeView).FullName

            End Get
            Set(value As String)
                MyBase.ThemeClassName = value
            End Set
        End Property
    End Class
</code></pre>

<p>Finally, lets populate the tree and test the new behavior:</p>

<h4>__[C#] __</h4>

<pre><code>            customTreeView1.AllowDragDrop = true;
            customTreeView1.MultiSelect = true;

            customTreeView2.AllowDragDrop = true;
            customTreeView2.MultiSelect = true;

            for (int i = 0; i &lt; 10; i++)
            {
                customTreeView1.Nodes.Add("First tree node " + i);
                customTreeView2.Nodes.Add("Second tree node " + i);
            }
</code></pre>

<h4>__[VB.NET] __</h4>

<pre><code>        CustomTreeView1.AllowDragDrop = True
        CustomTreeView1.MultiSelect = True

        CustomTreeView2.AllowDragDrop = True
        CustomTreeView2.MultiSelect = True

        For i As Integer = 0 To 9
            CustomTreeView1.Nodes.Add("First tree node " &amp; i)
            CustomTreeView2.Nodes.Add("Second tree node " &amp; i)
        Next i
</code></pre>

<p>The result can be observed at the screen shot at the top.</p>
        </article>
    </div>	
</div>

<footer>	
    <p><a onclick="javascript:SubmitFeedback('documentation@telerik.com','Telerik UI for WinForms','','','','%0\dYour%20feedback%20is%20used%20to%20improve%20the%20documentation%20and%20the%20product.%20Your%20e-mail%20address%20will%20not%20be%20used%20for%20any%20other%20purpose%20and%20is%20disposed%20of%20after%20the%20issue%20you%20report%20is%20resolved.%20%20While%20working%20to%20resolve%20the%20issue%20that%20you%20report,%20you%20may%20be%20contacted%20via%20e-mail%20to%20get%20further%20details%20or%20clarification%20on%20the%20feedback%20you%20sent.%20After%20the%20issue%20you%20report%20has%20been%20addressed,%20you%20may%20receive%20an%20e-mail%20to%20let%20you%20know%20that%20your%20feedback%20has%20been%20addressed.%0\A%0\d','Customer%20Feedback'); return false;" href="javascript:;" id="send-feedback">Send Feedback</a> Copyright &copy; 2002-<span id="toYear"></span> Telerik. All rights reserved.</p>
</footer>

    </body>
</html>

