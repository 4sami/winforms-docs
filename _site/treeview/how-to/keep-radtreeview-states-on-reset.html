<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=9">
        <title>Keep RadTreeView states on reset</title>
		
        <link href="/devtools/winforms/favicon.ico?Version=2014" rel="shortcut icon" />
		
        <meta name="description" content="Keep RadTreeView states on reset">
        <link href="http://cdn.kendostatic.com/2014.2.716/styles/kendo.common.min.css" rel="stylesheet" />
        <link rel="stylesheet" href="/devtools/winforms/assets/styles-849dcaf701d866988e8c3593f15b66de.css">
        <link rel="stylesheet" href="/devtools/winforms/assets/theme-52ac78f88dc084a004a9f7d63a3c4245.css">
        <link rel="stylesheet" href="/devtools/winforms/assets/branding-fafb6ed99bf90d251675534381e6f139.css">
        <link rel="stylesheet" href="/devtools/winforms/assets/highlight-49ceada082f1c903edb130c25d09cf1f.css">
        <script src="http://code.jquery.com/jquery-1.10.2.js"></script>
        <script src="http://cdn.kendostatic.com/2014.2.716/js/kendo.web.min.js"></script>
        <script src="/devtools/winforms/assets/prettify-31f05a2784b46b14f119862e47123f4c.js"></script>
        <script src="/devtools/winforms/assets/app-6da8e8e1ef6e19ee4a020ec34f48078c.js"></script>
		<script src="/devtools/winforms/assets/prettify-31f05a2784b46b14f119862e47123f4c.js"></script>
        <script src="/devtools/winforms/assets/branding-59377013fb75f02a1dbffd638033ef6d.js"></script>
		<script src="/devtools/winforms/assets/feedback-76cd418a099f8d21592f412fb4a31191.js"></script>
		
		<!--[if lt IE 9]>
		<script>
		document.createElement('header');
		document.createElement('nav');
		document.createElement('section');
		document.createElement('article');
		document.createElement('aside');
		document.createElement('footer');
		document.createElement('hgroup');
		</script>
		<![endif]-->
    </head>
    <body class="faux-columns">
        <!-- Google Tag Manager -->
        <noscript>
            <iframe src="//www.googletagmanager.com/ns.html?id=GTM-6X92" height="0" width="0" style="display: none; visibility: hidden"></iframe>
        </noscript>
        <script>(function(w, d, s, l, i) { w[l] = w[l] || []; w[l].push({ 'gtm.start': new Date().getTime(), event: 'gtm.js' }); var f = d.getElementsByTagName(s)[0], j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : ''; j.async = true; j.src = '//www.googletagmanager.com/gtm.js?id=' + i + dl; f.parentNode.insertBefore(j, f); })(window, document, 'script', 'dataLayer', 'GTM-6X92');</script>
        <!-- End Google Tag Manager -->
        <header id="page-header">
			<span class="toggle-nav"><span></span></span>
            <div id="logo-bar">
	<a href="/devtools/winforms/" title="UI for WinForms">
		<span>UI for WinForms</span>
	</a>
</div> 
<div id="page-search">
	<script>
  (function() {
    var cx = '001595215763381649090:jt1stbj813w';
    var gcse = document.createElement('script');
    gcse.async = true;
    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
        '//www.google.com/cse/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>

</div>

<span class="show-search">
	<span class="k-icon k-i-search"></span>
</span>

<div class="nav-buttons">
	<a href="http://demos.telerik.com/" title="WinForms Demos" target="_blank" class="btn demos-btn">Demos</a>	
	<a href="http://www.telerik.com/products/winforms.aspx" title="About UI for WinForms" target="_blank" class="btn about-btn">About</a>
	<a href="http://www.telerik.com/purchase/individual/winforms.aspx" title="Pricing" target="_blank" class="btn pricing-btn">Pricing</a>
	<a href="http://www.telerik.com/products/winforms/download.aspx" title="Try now" target="_blank" class="btn btn-primary">Try now</a>
</div>





        </header>

        <div id="page-inner-content">
    <div id="page-nav">
        <div id="page-tree"></div>
        <script>
			$("#page-tree").kendoTreeView({
				dataSource: {
					transport: {
						read: {
							url: "/devtools/winforms/default.json",
							dataType: "json"
						}
					},
					schema: {
						model: {
							id: "path",
							children: "items",
							hasChildren: "items"
						}
					}
				},
				select: preventParentSelection,
				template: navigationTemplate("/devtools/winforms/"),
				dataBound: expandNavigation("treeview/how-to/keep-radtreeview-states-on-reset.html")
			});
        </script>
		<div id="page-api" class="k-treeview">
			<ul class="k-group">
				<li class="k-item">
					<span class="k-icon k-plus" role="presentation"></span>
					<span class="k-in">
						<a href="/devtools/winforms/api/" target="_blank">API Reference</a>
					</span>
				</li>
			</ul>
		</div>			
    </div>
	<a id="page-edit-link" class="btn btn-action" href="https://github.com/telerik/xaml-docs/edit/master/treeview/how-to/keep-radtreeview-states-on-reset.md">Edit this page</a>
    <div id="page-article">       
        <article>
            <h1 id="keep-radtreeview-states-on-reset"><a href="#keep-radtreeview-states-on-reset">Keep RadTreeView states on reset</a></h1>

<p>The <strong>RadTreeView</strong> is a control that allows you to visualize hierarchical structures of data in the form of a tree.<br>
        However, when in bound mode, when a change in the underlying data source occurs, the tree needs to repopulate itself in order to get the latest changes.<br>
        As a result, the Expanded state of the available nodes, selection and scroll bar position are not kept. This article explains how to save the tree state<br>
        prior the change and restore it afterwards.</p>

<p>The following code snippet demonstrates how to populate the <strong>RadTreeView</strong> with hierarchical data.</p>

<h4><strong>[C#]</strong></h4>

<pre><code>        public KeepTreeViewStates()
        {
            InitializeComponent();

            BindingList&lt;ChildObject&gt; bikesChildren = new BindingList&lt;ChildObject&gt;();
            bikesChildren.Add(new ChildObject(567, "Bicycle"));
            bikesChildren.Add(new ChildObject(456, "Car"));
            bikesChildren.Add(new ChildObject(789, "Bike"));

            BindingList&lt;ChildObject&gt; clothingChildren = new BindingList&lt;ChildObject&gt;();
            clothingChildren.Add(new ChildObject(352, "T-shirt"));
            clothingChildren.Add(new ChildObject(981, "Dress"));

            List&lt;ParentObject&gt; parents = new List&lt;ParentObject&gt;();
            parents.Add(new ParentObject(182,"Bikes", bikesChildren));
            parents.Add(new ParentObject(346,"Accessories", null));
            parents.Add(new ParentObject(291,"Clothing", clothingChildren));

            radTreeView1.DataSource = parents;
            radTreeView1.DisplayMember = "Title\\Description";
            radTreeView1.ChildMember = "Parents\\Children";
            radTreeView1.MultiSelect = true;
        }

        public class ParentObject
        {
            public int ID { get; set; }

            public string Title { get; set; }

            public BindingList&lt;ChildObject&gt; Children { get; set; }

            public ParentObject(int iD, string title, BindingList&lt;ChildObject&gt; children)
            {
                this.ID = iD;
                this.Title = title;
                this.Children = children;
            }
        }

        public class ChildObject: INotifyPropertyChanged
        { 
            public event PropertyChangedEventHandler PropertyChanged;

            private int id;
            private string description;

            public int ID
            {
                get
                {
                    return this.id;
                }
                set
                {
                    this.id = value;
                    OnPropertyChanged("ID");
                }
            }

            public string Description
            {
                get
                {
                    return this.description;
                }
                set
                {
                    this.description = value;
                    OnPropertyChanged("Description");
                }
            }

            public ChildObject(int iD, string description)
            {
                this.id = iD;
                this.description = description;
            }

            protected virtual void OnPropertyChanged(string propertyName)
            {
                if (PropertyChanged != null)
                {
                    PropertyChanged(this, new PropertyChangedEventArgs(propertyName));
                }
            }
        }
</code></pre>

<h4><strong>[VB.NET]</strong></h4>

<pre><code>    Public Sub New()
        InitializeComponent()

        Dim bikesChildren As New BindingList(Of ChildObject)()
        bikesChildren.Add(New ChildObject(567, "Bicycle"))
        bikesChildren.Add(New ChildObject(456, "Car"))
        bikesChildren.Add(New ChildObject(789, "Bike"))

        Dim clothingChildren As New BindingList(Of ChildObject)()
        clothingChildren.Add(New ChildObject(352, "T-shirt"))
        clothingChildren.Add(New ChildObject(981, "Dress"))

        Dim parents As New List(Of ParentObject)()
        parents.Add(New ParentObject(182, "Bikes", bikesChildren))
        parents.Add(New ParentObject(346, "Accessories", Nothing))
        parents.Add(New ParentObject(291, "Clothing", clothingChildren))

        RadTreeView1.DataSource = parents
        RadTreeView1.DisplayMember = "Title\Description"
        RadTreeView1.ChildMember = "Parents\Children"
        RadTreeView1.MultiSelect = True
    End Sub

    Public Class ParentObject
        Public Property ID() As Integer
            Get
                Return m_ID
            End Get
            Set(value As Integer)
                m_ID = value
            End Set
        End Property
        Private m_ID As Integer

        Public Property Title() As String
            Get
                Return m_Title
            End Get
            Set(value As String)
                m_Title = value
            End Set
        End Property
        Private m_Title As String

        Public Property Children() As BindingList(Of ChildObject)
            Get
                Return m_Children
            End Get
            Set(value As BindingList(Of ChildObject))
                m_Children = value
            End Set
        End Property
        Private m_Children As BindingList(Of ChildObject)

        Public Sub New(iD As Integer, title As String, children As BindingList(Of ChildObject))
            Me.ID = iD
            Me.Title = title
            Me.Children = children
        End Sub
    End Class

    Public Class ChildObject
    Implements System.ComponentModel.INotifyPropertyChanged

        Public Event PropertyChanged As PropertyChangedEventHandler Implements System.ComponentModel.INotifyPropertyChanged.PropertyChanged

        Private m_id As Integer
        Private m_description As String

        Public Property ID() As Integer
            Get
                Return Me.m_id
            End Get
            Set(value As Integer)
                Me.m_id = value
                OnPropertyChanged("ID")
            End Set
        End Property

        Public Property Description() As String
            Get
                Return Me.m_description
            End Get
            Set(value As String)
                Me.m_description = value
                OnPropertyChanged("Description")
            End Set
        End Property

        Public Sub New(iD As Integer, description As String)
            Me.m_id = iD
            Me.m_description = description
        End Sub

        Protected Overridable Sub OnPropertyChanged(propertyName As String)
            RaiseEvent PropertyChanged(Me, New PropertyChangedEventArgs(propertyName))
        End Sub
    End Class

    #End Region

    #Region "KeepTreeViewStates"

    Private Sub radButtonAdd_Click(sender As Object, e As EventArgs) Handles RadButtonAdd.Click
        Dim scrollBarValue As Integer = RadTreeView1.VScrollBar.Value
        For Each nodeToSave As RadTreeNode In RadTreeView1.Nodes
            SaveExpandedStates(nodeToSave)
        Next

        Dim parent As ParentObject = TryCast(RadTreeView1.Nodes(0).DataBoundItem, ParentObject)
        parent.Children.Add(New ChildObject(673, "New child"))

        RadTreeView1.TreeViewElement.Update(RadTreeViewElement.UpdateActions.ItemAdded)

        For Each nodeToRestore As RadTreeNode In RadTreeView1.Nodes
            RestoreExpandedStates(nodeToRestore)
        Next
        RadTreeView1.VScrollBar.Value = scrollBarValue
    End Sub

    Private Sub radButtonDelete_Click(sender As Object, e As EventArgs) Handles RadButtonDelete.Click
        Dim scrollBarValue As Integer = RadTreeView1.VScrollBar.Value
        For Each nodeToSave As RadTreeNode In RadTreeView1.Nodes
            SaveExpandedStates(nodeToSave)
        Next

        Dim parent As ParentObject = TryCast(RadTreeView1.Nodes(0).DataBoundItem, ParentObject)
        parent.Children.Clear()

        RadTreeView1.TreeViewElement.Update(RadTreeViewElement.UpdateActions.ItemRemoved)

        For Each nodeToRestore As RadTreeNode In RadTreeView1.Nodes
            RestoreExpandedStates(nodeToRestore)
        Next
        RadTreeView1.VScrollBar.Value = scrollBarValue
    End Sub

    Private Sub radButtonUpdate_Click(sender As Object, e As EventArgs) Handles RadButtonUpdate.Click
        Dim scrollBarValue As Integer = RadTreeView1.VScrollBar.Value
        For Each nodeToSave As RadTreeNode In RadTreeView1.Nodes
            SaveExpandedStates(nodeToSave)
        Next

        Dim parent As ParentObject = TryCast(RadTreeView1.Nodes(2).DataBoundItem, ParentObject)
        parent.Children(1).Description = "New description"

        For Each nodeToRestore As RadTreeNode In RadTreeView1.Nodes
            RestoreExpandedStates(nodeToRestore)
        Next
        RadTreeView1.VScrollBar.Value = scrollBarValue
    End Sub

    #End Region

    #Region "SaveRestore"

    Private nodeStates As New Dictionary(Of Object, State)()

    Private Structure State
        Public Property Expanded() As Boolean
            Get
                Return m_Expanded
            End Get
            Set(value As Boolean)
                m_Expanded = value
            End Set
        End Property
        Private m_Expanded As Boolean

        Public Property Selected() As Boolean
            Get
                Return m_Selected
            End Get
            Set(value As Boolean)
                m_Selected = value
            End Set
        End Property
        Private m_Selected As Boolean

        Public Sub New(expanded As Boolean, selected As Boolean)
            Me.Expanded = expanded
            Me.Selected = selected
        End Sub
    End Structure

    Private Sub SaveExpandedStates(nodeToSave As RadTreeNode)
        If True Then
            If nodeToSave IsNot Nothing AndAlso nodeToSave.DataBoundItem IsNot Nothing Then
                If Not nodeStates.ContainsKey(nodeToSave.DataBoundItem) Then
                    nodeStates.Add(nodeToSave.DataBoundItem, New State(nodeToSave.Expanded, nodeToSave.Selected))
                Else
                    nodeStates(nodeToSave.DataBoundItem) = New State(nodeToSave.Expanded, nodeToSave.Selected)
                End If
            End If
            For Each childNode As RadTreeNode In nodeToSave.Nodes
                SaveExpandedStates(childNode)
            Next
        End If
    End Sub

    Private Sub RestoreExpandedStates(nodeToRestore As RadTreeNode)
        If nodeToRestore IsNot Nothing AndAlso nodeToRestore.DataBoundItem IsNot Nothing AndAlso nodeStates.ContainsKey(nodeToRestore.DataBoundItem) Then
            nodeToRestore.Expanded = nodeStates(nodeToRestore.DataBoundItem).Expanded
            nodeToRestore.Selected = nodeStates(nodeToRestore.DataBoundItem).Selected
        End If

        For Each childNode As RadTreeNode In nodeToRestore.Nodes
            RestoreExpandedStates(childNode)
        Next
    End Sub

    #End Region

End Class
</code></pre>

<p>On the left figure, you can see the tree with some selected and expanded nodes and the scroll bar in the middle of the tree.<br>
          On the right figure, you see how the tree is collapsed after we add a node to its data source.</p>

<table>
<tr>
<td>Initial state</td>
<td>After a change in the data source occurs</td>
</tr>
<tr>
<td>![treeview-how-to-keep-radtreeview-states-on-reset 001](images/treeview-how-to-keep-radtreeview-states-on-reset001.png)</td>
<td>![treeview-how-to-keep-radtreeview-states-on-reset 002](images/treeview-how-to-keep-radtreeview-states-on-reset002.png)</td>
</tr>
</table>

<p>Unfortunately, a solution of this cannot be added to the control as it<br>
          depends on the case and there has to be logic added for the specific case to be handled.To keep the expanded<br>
          and selected state of RadTreeView after a change in the data source occurs, we can use a Dictionary with some<br>
          unique value for a key i.e. this could be the node’s Text, DataBoundItem, Value, or even an ID taken from the<br>
          DataBoundItem and store the state for the node in it. The following example demonstrates how to create a simple<br>
          structure State, which will hold and describe the state of a node. The SaveExpandedStates method is used to recursively<br>
          iterate all nodes in RadTreeView and populate a dictionary with the nodes information. The RestoreExpandedStates is <br>
          used to read the saved states from the dictionary, find the respective node and restore its state.</p>

<h4><strong>[C#]</strong></h4>

<pre><code>        Dictionary&lt;object, State&gt; nodeStates = new Dictionary&lt;object, State&gt;();

        struct State
        {
            public bool Expanded { get; set; }

            public bool Selected { get; set; }

            public State(bool expanded, bool selected) : this()
            {
                this.Expanded = expanded;
                this.Selected = selected;
            }
        }

        private void SaveExpandedStates(RadTreeNode nodeToSave)
        {
            {
                if (nodeToSave != null &amp;&amp; nodeToSave.DataBoundItem != null)
                {
                    if (! nodeStates.ContainsKey(nodeToSave.DataBoundItem))
                    {
                        nodeStates.Add(nodeToSave.DataBoundItem, new State(nodeToSave.Expanded, nodeToSave.Selected));
                    }
                    else
                    {
                        nodeStates[nodeToSave.DataBoundItem] = new State(nodeToSave.Expanded, nodeToSave.Selected);
                    }
                }
                foreach (RadTreeNode childNode in nodeToSave.Nodes)
                {
                    SaveExpandedStates(childNode);
                }
            }
        }

        private void RestoreExpandedStates(RadTreeNode nodeToRestore)
        {
            if (nodeToRestore != null &amp;&amp; nodeToRestore.DataBoundItem != null &amp;&amp;
                nodeStates.ContainsKey(nodeToRestore.DataBoundItem))
            {
                nodeToRestore.Expanded = nodeStates[nodeToRestore.DataBoundItem].Expanded;
                nodeToRestore.Selected = nodeStates[nodeToRestore.DataBoundItem].Selected;
            }

            foreach (RadTreeNode childNode in nodeToRestore.Nodes)
            {
                RestoreExpandedStates(childNode);
            }
        }
</code></pre>

<h4><strong>[VB.NET]</strong></h4>

<pre><code>    Private nodeStates As New Dictionary(Of Object, State)()

    Private Structure State
        Public Property Expanded() As Boolean
            Get
                Return m_Expanded
            End Get
            Set(value As Boolean)
                m_Expanded = value
            End Set
        End Property
        Private m_Expanded As Boolean

        Public Property Selected() As Boolean
            Get
                Return m_Selected
            End Get
            Set(value As Boolean)
                m_Selected = value
            End Set
        End Property
        Private m_Selected As Boolean

        Public Sub New(expanded As Boolean, selected As Boolean)
            Me.Expanded = expanded
            Me.Selected = selected
        End Sub
    End Structure

    Private Sub SaveExpandedStates(nodeToSave As RadTreeNode)
        If True Then
            If nodeToSave IsNot Nothing AndAlso nodeToSave.DataBoundItem IsNot Nothing Then
                If Not nodeStates.ContainsKey(nodeToSave.DataBoundItem) Then
                    nodeStates.Add(nodeToSave.DataBoundItem, New State(nodeToSave.Expanded, nodeToSave.Selected))
                Else
                    nodeStates(nodeToSave.DataBoundItem) = New State(nodeToSave.Expanded, nodeToSave.Selected)
                End If
            End If
            For Each childNode As RadTreeNode In nodeToSave.Nodes
                SaveExpandedStates(childNode)
            Next
        End If
    End Sub

    Private Sub RestoreExpandedStates(nodeToRestore As RadTreeNode)
        If nodeToRestore IsNot Nothing AndAlso nodeToRestore.DataBoundItem IsNot Nothing AndAlso nodeStates.ContainsKey(nodeToRestore.DataBoundItem) Then
            nodeToRestore.Expanded = nodeStates(nodeToRestore.DataBoundItem).Expanded
            nodeToRestore.Selected = nodeStates(nodeToRestore.DataBoundItem).Selected
        End If

        For Each childNode As RadTreeNode In nodeToRestore.Nodes
            RestoreExpandedStates(childNode)
        Next
    End Sub

    #End Region

End Class
</code></pre>

<p>Once we have these methods implemented, we can use the dictionary to save the RadTreeView state prior the change occurs and restore it afterwards.<br>
          In the example below, we are also saving and restoring the scroll bar position.</p>

<h4><strong>[C#]</strong></h4>

<pre><code>        private void radButtonAdd_Click(object sender, EventArgs e)
        {
            int scrollBarValue = radTreeView1.VScrollBar.Value;           
            foreach (RadTreeNode nodeToSave in radTreeView1.Nodes)
            {
                SaveExpandedStates(nodeToSave);
            }

            ParentObject parent = radTreeView1.Nodes[0].DataBoundItem as ParentObject;
            parent.Children.Add(new ChildObject(673,"New child"));    

            radTreeView1.TreeViewElement.Update(RadTreeViewElement.UpdateActions.ItemAdded);

            foreach (RadTreeNode nodeToRestore in radTreeView1.Nodes)
            {
                RestoreExpandedStates(nodeToRestore);
            }
            radTreeView1.VScrollBar.Value = scrollBarValue;
        }

        private void radButtonDelete_Click(object sender, EventArgs e)
        {
            int scrollBarValue = radTreeView1.VScrollBar.Value;           
            foreach (RadTreeNode nodeToSave in radTreeView1.Nodes)
            {
                SaveExpandedStates(nodeToSave);
            }

            ParentObject parent = radTreeView1.Nodes[0].DataBoundItem as ParentObject;
            parent.Children.Clear();

            radTreeView1.TreeViewElement.Update(RadTreeViewElement.UpdateActions.ItemRemoved);

            foreach (RadTreeNode nodeToRestore in radTreeView1.Nodes)
            {
                RestoreExpandedStates(nodeToRestore);
            }
            radTreeView1.VScrollBar.Value = scrollBarValue;
        }

        private void radButtonUpdate_Click(object sender, EventArgs e)
        {
            int scrollBarValue = radTreeView1.VScrollBar.Value;           
            foreach (RadTreeNode nodeToSave in radTreeView1.Nodes)
            {
                SaveExpandedStates(nodeToSave);
            }

            ParentObject parent = radTreeView1.Nodes[2].DataBoundItem as ParentObject;
            parent.Children[1].Description = "New description";

            foreach (RadTreeNode nodeToRestore in radTreeView1.Nodes)
            {
                RestoreExpandedStates(nodeToRestore);
            }
            radTreeView1.VScrollBar.Value = scrollBarValue;
        }
</code></pre>

<h4><strong>[VB.NET]</strong></h4>

<pre><code>    Private Sub radButtonAdd_Click(sender As Object, e As EventArgs) Handles RadButtonAdd.Click
        Dim scrollBarValue As Integer = RadTreeView1.VScrollBar.Value
        For Each nodeToSave As RadTreeNode In RadTreeView1.Nodes
            SaveExpandedStates(nodeToSave)
        Next

        Dim parent As ParentObject = TryCast(RadTreeView1.Nodes(0).DataBoundItem, ParentObject)
        parent.Children.Add(New ChildObject(673, "New child"))

        RadTreeView1.TreeViewElement.Update(RadTreeViewElement.UpdateActions.ItemAdded)

        For Each nodeToRestore As RadTreeNode In RadTreeView1.Nodes
            RestoreExpandedStates(nodeToRestore)
        Next
        RadTreeView1.VScrollBar.Value = scrollBarValue
    End Sub

    Private Sub radButtonDelete_Click(sender As Object, e As EventArgs) Handles RadButtonDelete.Click
        Dim scrollBarValue As Integer = RadTreeView1.VScrollBar.Value
        For Each nodeToSave As RadTreeNode In RadTreeView1.Nodes
            SaveExpandedStates(nodeToSave)
        Next

        Dim parent As ParentObject = TryCast(RadTreeView1.Nodes(0).DataBoundItem, ParentObject)
        parent.Children.Clear()

        RadTreeView1.TreeViewElement.Update(RadTreeViewElement.UpdateActions.ItemRemoved)

        For Each nodeToRestore As RadTreeNode In RadTreeView1.Nodes
            RestoreExpandedStates(nodeToRestore)
        Next
        RadTreeView1.VScrollBar.Value = scrollBarValue
    End Sub

    Private Sub radButtonUpdate_Click(sender As Object, e As EventArgs) Handles RadButtonUpdate.Click
        Dim scrollBarValue As Integer = RadTreeView1.VScrollBar.Value
        For Each nodeToSave As RadTreeNode In RadTreeView1.Nodes
            SaveExpandedStates(nodeToSave)
        Next

        Dim parent As ParentObject = TryCast(RadTreeView1.Nodes(2).DataBoundItem, ParentObject)
        parent.Children(1).Description = "New description"

        For Each nodeToRestore As RadTreeNode In RadTreeView1.Nodes
            RestoreExpandedStates(nodeToRestore)
        Next
        RadTreeView1.VScrollBar.Value = scrollBarValue
    End Sub

    #End Region

    #Region "SaveRestore"

    Private nodeStates As New Dictionary(Of Object, State)()

    Private Structure State
        Public Property Expanded() As Boolean
            Get
                Return m_Expanded
            End Get
            Set(value As Boolean)
                m_Expanded = value
            End Set
        End Property
        Private m_Expanded As Boolean

        Public Property Selected() As Boolean
            Get
                Return m_Selected
            End Get
            Set(value As Boolean)
                m_Selected = value
            End Set
        End Property
        Private m_Selected As Boolean

        Public Sub New(expanded As Boolean, selected As Boolean)
            Me.Expanded = expanded
            Me.Selected = selected
        End Sub
    End Structure

    Private Sub SaveExpandedStates(nodeToSave As RadTreeNode)
        If True Then
            If nodeToSave IsNot Nothing AndAlso nodeToSave.DataBoundItem IsNot Nothing Then
                If Not nodeStates.ContainsKey(nodeToSave.DataBoundItem) Then
                    nodeStates.Add(nodeToSave.DataBoundItem, New State(nodeToSave.Expanded, nodeToSave.Selected))
                Else
                    nodeStates(nodeToSave.DataBoundItem) = New State(nodeToSave.Expanded, nodeToSave.Selected)
                End If
            End If
            For Each childNode As RadTreeNode In nodeToSave.Nodes
                SaveExpandedStates(childNode)
            Next
        End If
    End Sub

    Private Sub RestoreExpandedStates(nodeToRestore As RadTreeNode)
        If nodeToRestore IsNot Nothing AndAlso nodeToRestore.DataBoundItem IsNot Nothing AndAlso nodeStates.ContainsKey(nodeToRestore.DataBoundItem) Then
            nodeToRestore.Expanded = nodeStates(nodeToRestore.DataBoundItem).Expanded
            nodeToRestore.Selected = nodeStates(nodeToRestore.DataBoundItem).Selected
        End If

        For Each childNode As RadTreeNode In nodeToRestore.Nodes
            RestoreExpandedStates(childNode)
        Next
    End Sub

    #End Region

End Class
</code></pre>

<p>Now, using these methods the tree states will be restored accordingly.</p>

<table>
<tr>
<td>Initial state</td>
<td>After a change in the data source occurs</td>
</tr>
<tr>
<td>![treeview-how-to-keep-radtreeview-states-on-reset 003](images/treeview-how-to-keep-radtreeview-states-on-reset003.png)</td>
<td>![treeview-how-to-keep-radtreeview-states-on-reset 004](images/treeview-how-to-keep-radtreeview-states-on-reset004.png)</td>
</tr>
</table>
        </article>
    </div>	
</div>

<footer>	
    <p><a onclick="javascript:SubmitFeedback('documentation@telerik.com','Telerik UI for WinForms','','','','%0\dYour%20feedback%20is%20used%20to%20improve%20the%20documentation%20and%20the%20product.%20Your%20e-mail%20address%20will%20not%20be%20used%20for%20any%20other%20purpose%20and%20is%20disposed%20of%20after%20the%20issue%20you%20report%20is%20resolved.%20%20While%20working%20to%20resolve%20the%20issue%20that%20you%20report,%20you%20may%20be%20contacted%20via%20e-mail%20to%20get%20further%20details%20or%20clarification%20on%20the%20feedback%20you%20sent.%20After%20the%20issue%20you%20report%20has%20been%20addressed,%20you%20may%20receive%20an%20e-mail%20to%20let%20you%20know%20that%20your%20feedback%20has%20been%20addressed.%0\A%0\d','Customer%20Feedback'); return false;" href="javascript:;" id="send-feedback">Send Feedback</a> Copyright &copy; 2002-<span id="toYear"></span> Telerik. All rights reserved.</p>
</footer>

    </body>
</html>

