<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=9">
        <title>Combining RadDragDropService and OLE drag-and-drop</title>
		
        <link href="/devtools/winforms/favicon.ico?Version=2014" rel="shortcut icon" />
		
        <meta name="description" content="Combining RadDragDropService and OLE drag-and-drop">
        <link href="http://cdn.kendostatic.com/2014.2.716/styles/kendo.common.min.css" rel="stylesheet" />
        <link rel="stylesheet" href="/devtools/winforms/assets/styles-0b5a71aa940403cb3ac60d7e91e25e1d.css">
        <link rel="stylesheet" href="/devtools/winforms/assets/theme-52ac78f88dc084a004a9f7d63a3c4245.css">
        <link rel="stylesheet" href="/devtools/winforms/assets/branding-fafb6ed99bf90d251675534381e6f139.css">
        <link rel="stylesheet" href="/devtools/winforms/assets/highlight-49ceada082f1c903edb130c25d09cf1f.css">
        <script src="http://code.jquery.com/jquery-1.10.2.js"></script>
        <script src="http://cdn.kendostatic.com/2014.2.716/js/kendo.web.min.js"></script>
        <script src="/devtools/winforms/assets/prettify-31f05a2784b46b14f119862e47123f4c.js"></script>
        <script src="/devtools/winforms/assets/app-6da8e8e1ef6e19ee4a020ec34f48078c.js"></script>
		<script src="/devtools/winforms/assets/prettify-31f05a2784b46b14f119862e47123f4c.js"></script>
        <script src="/devtools/winforms/assets/branding-59377013fb75f02a1dbffd638033ef6d.js"></script>
		<script src="/devtools/winforms/assets/feedback-76cd418a099f8d21592f412fb4a31191.js"></script>
		
		<!--[if lt IE 9]>
		<script>
		document.createElement('header');
		document.createElement('nav');
		document.createElement('section');
		document.createElement('article');
		document.createElement('aside');
		document.createElement('footer');
		document.createElement('hgroup');
		</script>
		<![endif]-->
    </head>
    <body class="faux-columns">
        <!-- Google Tag Manager -->
        <noscript>
            <iframe src="//www.googletagmanager.com/ns.html?id=GTM-6X92" height="0" width="0" style="display: none; visibility: hidden"></iframe>
        </noscript>
        <script>(function(w, d, s, l, i) { w[l] = w[l] || []; w[l].push({ 'gtm.start': new Date().getTime(), event: 'gtm.js' }); var f = d.getElementsByTagName(s)[0], j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : ''; j.async = true; j.src = '//www.googletagmanager.com/gtm.js?id=' + i + dl; f.parentNode.insertBefore(j, f); })(window, document, 'script', 'dataLayer', 'GTM-6X92');</script>
        <!-- End Google Tag Manager -->
        <header id="page-header">
			<span class="toggle-nav"><span></span></span>
            


<div id="page-search">
	<script>
  (function() {
    var cx = '001595215763381649090:jt1stbj813w';
    var gcse = document.createElement('script');
    gcse.async = true;
    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
        '//www.google.com/cse/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>

</div>

<span class="show-search">
	<span class="k-icon k-i-search"></span>
</span>

<div class="nav-buttons">


</div>





        </header>

        <div id="page-inner-content">
    <div id="page-nav">
        <div id="page-tree"></div>
        <script>
			$("#page-tree").kendoTreeView({
				dataSource: {
					transport: {
						read: {
							url: "/devtools/winforms/default.json",
							dataType: "json"
						}
					},
					schema: {
						model: {
							id: "path",
							children: "items",
							hasChildren: "items"
						}
					}
				},
				select: preventParentSelection,
				template: navigationTemplate("/devtools/winforms/"),
				dataBound: expandNavigation("scheduler/drag-and-drop/combining-raddragdropservice-and-ole-drag-and-drop.html")
			});
        </script>
		<div id="page-api" class="k-treeview">
			<ul class="k-group">
				<li class="k-item">
					<span class="k-icon k-plus" role="presentation"></span>
					<span class="k-in">
						<a href="/devtools/winforms/api/" target="_blank">API Reference</a>
					</span>
				</li>
			</ul>
		</div>			
    </div>
	<a id="page-edit-link" class="btn btn-action" href="https://github.com/telerik/xaml-docs/edit/master/scheduler/drag-and-drop/combining-raddragdropservice-and-ole-drag-and-drop.md">Edit this page</a>
    <div id="page-article">       
        <article>
            <h1 id="combining-raddragdropservice-and-ole-drag-and-drop"><a href="#combining-raddragdropservice-and-ole-drag-and-drop">Combining RadDragDropService and OLE drag-and-drop</a></h1>

<p>This article demonstrates a sample approach how to achieve drag and drop functionality between <strong>RadScheduler</strong> and <strong>RadListControl</strong>.<br>
      For this purpose, we will use a combination between the <strong>RadDragDropService</strong>, supported by the <strong>RadScheduler</strong> control, and the OLE drag-and-drop,<br>
      which is supported by all controls from the Telerik UI for WinForms suite.</p>

<p>Letâ€™s assume that our <strong>RadScheduler</strong> is in  <a href="/devtools/winforms/scheduler/data-binding/data-binding-walkthrough">bound mode</a> <br>
        and the <strong>RadListControl</strong> is populated manually with items. Set the <strong>AllowDrop</strong> property to <em>true</em> for both of the controls.</p>

<h2 id="drag-and-drop-from-radscheduler-to-radlistcontrol-using-raddragdropservice"><a href="#drag-and-drop-from-radscheduler-to-radlistcontrol-using-raddragdropservice">Drag and drop from RadScheduler to RadListControl using RadDragDropService</a></h2>

<p>To implement drag and drop functionality for this scenario, we will use the SchedulerElement.<strong>DragDropBehavior</strong>,<br>
        which is a derivative of the <strong>RadDragDropService</strong>. Subscribe to its <strong>PreviewDragOver</strong> and <strong>PreviewDragDrop</strong> events.<br>
        In the <strong>PreviewDragOver</strong> event allow dropping over a <strong>RadListElement</strong>. The <strong>PreviewDragDrop</strong> event performs the actual<br>
        inserting of the dragged appointment into the <strong>RadListControl.Items</strong> collection:</p>

<h4><strong>[C#]</strong></h4>

<pre><code>        private void DragDropBehavior_PreviewDragOver(object sender, Telerik.WinControls.RadDragOverEventArgs e)
        {
            e.CanDrop = e.HitTarget is RadListElement;
        }

        private void DragDropBehavior_PreviewDragDrop(object sender, Telerik.WinControls.RadDropEventArgs e)
        {
            DragFeedbackElement draggedInstance = e.DragInstance as DragFeedbackElement;
            if (draggedInstance == null)
            {
                return;
            }

            RadListElement listElement = e.HitTarget as RadListElement;
            if (listElement == null)
            {
                return;
            }
            e.Handled = true;
            RadListControl listControl = listElement.ElementTree.Control as RadListControl;
            RadListVisualItem targetItem = listControl.ElementTree.GetElementAtPoint(e.DropLocation) as RadListVisualItem;
            int indexToInsert;
            if (targetItem != null)
            {
                indexToInsert = targetItem.Data.RowIndex;
            }
            else
            {
                indexToInsert = listControl.Items.Count;
            }
            Appointment draggedAppointment = draggedInstance.AssociatedAppointment as Appointment;
            SchedulerUIHelper.DeleteAppointment(draggedAppointment, this.radScheduler1);
            RadListDataItem newItem = new RadListDataItem(draggedAppointment.Summary);
            listControl.Items.Insert(indexToInsert, newItem);

            //save changes to data base
            SaveChanges();
        }

        public void SaveChanges()
        {
            appointmentsResourcesTableAdapter.Adapter.AcceptChangesDuringUpdate = false;
            SchedulerDataDataSet.AppointmentsResourcesDataTable deletedChildRecords =
                this.schedulerDataDataSet.AppointmentsResources.GetChanges(DataRowState.Deleted)
                as SchedulerDataDataSet.AppointmentsResourcesDataTable;
            SchedulerDataDataSet.AppointmentsResourcesDataTable newChildRecords =
                this.schedulerDataDataSet.AppointmentsResources.GetChanges(DataRowState.Added)
                as SchedulerDataDataSet.AppointmentsResourcesDataTable;
            SchedulerDataDataSet.AppointmentsResourcesDataTable modifiedChildRecords =
                this.schedulerDataDataSet.AppointmentsResources.GetChanges(DataRowState.Modified)
                as SchedulerDataDataSet.AppointmentsResourcesDataTable;
            try
            {
                if (deletedChildRecords != null)
                {
                    appointmentsResourcesTableAdapter.Update(deletedChildRecords);
                }
                appointmentsTableAdapter.Update(this.schedulerDataDataSet.Appointments);
                if (newChildRecords != null)
                {
                    appointmentsResourcesTableAdapter.Update(newChildRecords);
                }
                if (modifiedChildRecords != null)
                {
                    appointmentsResourcesTableAdapter.Update(modifiedChildRecords);
                }
                this.schedulerDataDataSet.AcceptChanges();
            }
            catch (Exception ex)
            {
                MessageBox.Show(string.Format("An error occurred during the update process:\n{0}", ex.Message));
            }
            finally
            {
                if (deletedChildRecords != null)
                {
                    deletedChildRecords.Dispose();
                }
                if (newChildRecords != null)
                {
                    newChildRecords.Dispose();
                }
                if (modifiedChildRecords != null)
                {
                    modifiedChildRecords.Dispose();
                }
            }
        }
</code></pre>

<h4><strong>[VB.NET]</strong></h4>

<pre><code>    Private Sub DragDropBehavior_PreviewDragOver(sender As Object, e As Telerik.WinControls.RadDragOverEventArgs)
        e.CanDrop = TypeOf e.HitTarget Is RadListElement
    End Sub

    Private Sub DragDropBehavior_PreviewDragDrop(sender As Object, e As Telerik.WinControls.RadDropEventArgs)
        Dim draggedInstance As DragFeedbackElement = TryCast(e.DragInstance, DragFeedbackElement)
        If draggedInstance Is Nothing Then
            Return
        End If

        Dim listElement As RadListElement = TryCast(e.HitTarget, RadListElement)
        If listElement Is Nothing Then
            Return
        End If
        e.Handled = True
        Dim listControl As RadListControl = TryCast(listElement.ElementTree.Control, RadListControl)
        Dim targetItem As RadListVisualItem = TryCast(listControl.ElementTree.GetElementAtPoint(e.DropLocation), RadListVisualItem)
        Dim indexToInsert As Integer
        If targetItem IsNot Nothing Then
            indexToInsert = targetItem.Data.RowIndex
        Else
            indexToInsert = listControl.Items.Count
        End If
        Dim draggedAppointment As Appointment = TryCast(draggedInstance.AssociatedAppointment, Appointment)
        SchedulerUIHelper.DeleteAppointment(draggedAppointment, Me.RadScheduler1)
        Dim newItem As New RadListDataItem(draggedAppointment.Summary)
        listControl.Items.Insert(indexToInsert, newItem)

        'save changes to data base
        SaveChanges()
    End Sub

    Public Sub SaveChanges()
        AppointmentsResourcesTableAdapter.Adapter.AcceptChangesDuringUpdate = False
        Dim deletedChildRecords As SchedulerDataDataSet.AppointmentsResourcesDataTable = TryCast(Me.SchedulerDataDataSet.AppointmentsResources.GetChanges(DataRowState.Deleted), SchedulerDataDataSet.AppointmentsResourcesDataTable)
        Dim newChildRecords As SchedulerDataDataSet.AppointmentsResourcesDataTable = TryCast(Me.SchedulerDataDataSet.AppointmentsResources.GetChanges(DataRowState.Added), SchedulerDataDataSet.AppointmentsResourcesDataTable)
        Dim modifiedChildRecords As SchedulerDataDataSet.AppointmentsResourcesDataTable = TryCast(Me.SchedulerDataDataSet.AppointmentsResources.GetChanges(DataRowState.Modified), SchedulerDataDataSet.AppointmentsResourcesDataTable)
        Try
            If deletedChildRecords IsNot Nothing Then
                AppointmentsResourcesTableAdapter.Update(deletedChildRecords)
            End If
            AppointmentsTableAdapter.Update(Me.SchedulerDataDataSet.Appointments)
            If newChildRecords IsNot Nothing Then
                AppointmentsResourcesTableAdapter.Update(newChildRecords)
            End If
            If modifiedChildRecords IsNot Nothing Then
                AppointmentsResourcesTableAdapter.Update(modifiedChildRecords)
            End If
            Me.SchedulerDataDataSet.AcceptChanges()
        Catch ex As Exception
            MessageBox.Show(String.Format("An error occurred during the update process:" &amp; vbLf &amp; "{0}", ex.Message))
        Finally
            If deletedChildRecords IsNot Nothing Then
                deletedChildRecords.Dispose()
            End If
            If newChildRecords IsNot Nothing Then
                newChildRecords.Dispose()
            End If
            If modifiedChildRecords IsNot Nothing Then
                modifiedChildRecords.Dispose()
            End If
        End Try
    End Sub

    #End Region

    #Region "RadListControlToRadScheduler"

    #Region "StartDragDrop"

    Private mouseDownPosition As Point
    Private isDragging As Boolean

    Private Sub radListControl1_MouseMove(sender As Object, e As MouseEventArgs)
        If e.Button &lt;&gt; MouseButtons.Left Then
            Me.isDragging = False
            Return
        End If

        If Me.isDragging Then
            Return
        End If

        Dim currentPosition As Point = e.Location
        If (Math.Abs((currentPosition.X - Me.mouseDownPosition.X)) &gt;= SystemInformation.DragSize.Width) OrElse (Math.Abs((currentPosition.Y - Me.mouseDownPosition.Y)) &gt;= SystemInformation.DragSize.Height) Then
            Me.isDragging = True
            Dim dragObject As New DragObject()
            Dim draggedItem As RadListVisualItem = TryCast(Me.RadListControl1.ElementTree.GetElementAtPoint(currentPosition), RadListVisualItem)
            If draggedItem IsNot Nothing Then
                Dim itemText As String = draggedItem.Text

                If itemText &lt;&gt; String.Empty Then
                    dragObject.Values.Add(AppointmentFields.Summary, itemText)
                    dragObject.Status = AppointmentFields.Summary
                    'start the drag and drop operation
                    TryCast(sender, RadListControl).DoDragDrop(dragObject, DragDropEffects.Copy)
                End If
            End If
        End If
    End Sub

    Private Sub radScheduler1_DragEnter(sender As Object, e As DragEventArgs)
        Dim dragObject As DragObject = TryCast(e.Data.GetData(GetType(DragObject)), DragObject)
        'allow dragging over the RadScheduler
        e.Effect = If(dragObject Is Nothing, DragDropEffects.None, DragDropEffects.Copy)
    End Sub

    #End Region

    #Region "DoDragDrop"

    Private Sub radScheduler1_DragDrop(sender As Object, e As DragEventArgs)
        Dim point__1 As Point = Me.RadScheduler1.PointToClient(New Point(e.X, e.Y))
        Dim schedulerCell As SchedulerCellElement = SchedulerUIHelper.GetCellAtPoint(point__1, Me.RadScheduler1)

        If schedulerCell IsNot Nothing Then
            Dim dragObject As DragObject = TryCast(e.Data.GetData(GetType(DragObject)), DragObject)
            If dragObject IsNot Nothing Then
                Dim appointment As Appointment = CreateAppointment(schedulerCell.[Date], dragObject)
                Me.RadScheduler1.Appointments.Add(appointment)

                Dim indexToRemove As Integer = Me.RadListControl1.Items.IndexOf(appointment.Summary)
                If indexToRemove &gt; -1 Then
                    Me.RadListControl1.Items.RemoveAt(indexToRemove)
                End If
            End If
        End If

        Me.mouseDownPosition = Point.Empty
        Me.isDragging = False
        'save changes to database
        SaveChanges()
    End Sub

    #End Region

    #Region "DragHelper"

    Private Function CreateAppointment(currentDate As DateTime, dragObject As DragObject) As Appointment
        Dim appointment As New Appointment()
        Dim startDate As DateTime = currentDate
        Dim endDate As DateTime = currentDate.AddHours(1)
        Select Case dragObject.Status
            Case AppointmentFields.Summary
                appointment.Summary = TryCast(dragObject.Values(dragObject.Status), String)
                Exit Select
            Case AppointmentFields.Row
                appointment.Summary = TryCast(dragObject.Values(AppointmentFields.Summary), String)
                appointment.Description = TryCast(dragObject.Values(AppointmentFields.Description), String)
                appointment.BackgroundId = CInt(dragObject.Values(AppointmentFields.Background))
                appointment.StatusId = CInt(dragObject.Values(AppointmentFields.Status))
                appointment.Location = TryCast(dragObject.Values(AppointmentFields.Location), String)

                startDate = DirectCast(dragObject.Values(AppointmentFields.Start), DateTime)
                endDate = DirectCast(dragObject.Values(AppointmentFields.[End]), DateTime)

                Dim range As TimeSpan = endDate - startDate
                endDate = currentDate + range
                startDate = currentDate

                Exit Select
        End Select
        appointment.Start = startDate
        appointment.[End] = endDate
        Return appointment
    End Function

    Private Enum AppointmentFields
        Row
        Summary
        Location
        Description
        Start
        [End]
        Background
        Status
    End Enum

    Private Class DragObject
        Private m_status As AppointmentFields
        Private m_values As New Dictionary(Of AppointmentFields, Object)()

        Public Property Status() As AppointmentFields
            Get
                Return Me.m_status
            End Get
            Set(value As AppointmentFields)
                Me.m_status = value
            End Set
        End Property

        Public ReadOnly Property Values() As Dictionary(Of AppointmentFields, Object)
            Get
                Return Me.m_values
            End Get
        End Property
    End Class

    #End Region

    #End Region

    Private Sub BindScheduler()
        Dim appointmentMappingInfo As New AppointmentMappingInfo()
        appointmentMappingInfo.BackgroundId = "BackgroundID"
        appointmentMappingInfo.Description = "Description"
        appointmentMappingInfo.[End] = "End"
        appointmentMappingInfo.Location = "Location"
        appointmentMappingInfo.MasterEventId = "ParentID"
        appointmentMappingInfo.RecurrenceRule = "RecurrenceRule"
        appointmentMappingInfo.ResourceId = "ResourceID"
        appointmentMappingInfo.Resources = "Appointments_AppointmentsResources"
        appointmentMappingInfo.Start = "Start"
        appointmentMappingInfo.StatusId = "StatusID"
        appointmentMappingInfo.Summary = "Summary"
        SchedulerBindingDataSource1.EventProvider.Mapping = appointmentMappingInfo

        Dim resourceMappingInfo As New ResourceMappingInfo()
        resourceMappingInfo.Id = "ID"
        resourceMappingInfo.Name = "ResourceName"
        Me.SchedulerBindingDataSource1.ResourceProvider.Mapping = resourceMappingInfo

        SchedulerBindingDataSource1.ResourceProvider.DataSource = SchedulerDataDataSet.Resources
        SchedulerBindingDataSource1.EventProvider.DataSource = SchedulerDataDataSet.Appointments

        RadScheduler1.DataSource = SchedulerBindingDataSource1
    End Sub

    Private Sub SchedulerToListControl_Load(sender As Object, e As EventArgs) Handles MyBase.Load
        'TODO: This line of code loads data into the 'SchedulerDataDataSet.Resources' table. You can move, or remove it, as needed.
        Me.ResourcesTableAdapter.Fill(Me.SchedulerDataDataSet.Resources)
        'TODO: This line of code loads data into the 'SchedulerDataDataSet.AppointmentsResources' table. You can move, or remove it, as needed.
        Me.AppointmentsResourcesTableAdapter.Fill(Me.SchedulerDataDataSet.AppointmentsResources)
        'TODO: This line of code loads data into the 'SchedulerDataDataSet.Appointments' table. You can move, or remove it, as needed.
        Me.AppointmentsTableAdapter.Fill(Me.SchedulerDataDataSet.Appointments)

    End Sub
End Class
</code></pre>

<p><img src="images/scheduler-drag-and-drop-combining-raddragdropservice-and-ole-drag-and-drop001.gif" alt="scheduler-drag-and-drop-combining-raddragdropservice-and-ole-drag-and-drop 001"></p>

<h2 id="drag-and-drop-from-radlistcontrol-to-radscheduler-using-the-ole-drag-and-drop"><a href="#drag-and-drop-from-radlistcontrol-to-radscheduler-using-the-ole-drag-and-drop">Drag and drop from RadListControl to RadScheduler using the OLE drag-and-drop</a></h2>

<ol>
<li>Firstly, we should start the drag and drop operation using the RadListControl.<strong>MouseMove</strong> event when the left mouse button is pressed.
        Afterwards, allow dragging over the <strong>RadScheduler</strong> via the <strong>Effect</strong> argument of the <strong>DragEventArgs</strong>
          in the RadScheduler.<strong>DragEnter</strong> event handler:</li>
</ol>

<h4><strong>[C#]</strong></h4>

<pre><code>        private Point mouseDownPosition;
        private bool isDragging;

        private void radListControl1_MouseMove(object sender, MouseEventArgs e)
        {
            if (e.Button != MouseButtons.Left)
            {
                this.isDragging = false;
                return;
            }

            if (this.isDragging)
                return;

            Point currentPosition = e.Location;
            if ((Math.Abs((currentPosition.X - this.mouseDownPosition.X)) &gt;= SystemInformation.DragSize.Width) ||
                (Math.Abs((currentPosition.Y - this.mouseDownPosition.Y)) &gt;= SystemInformation.DragSize.Height))
            {
                this.isDragging = true;
                DragObject dragObject = new DragObject();
                RadListVisualItem draggedItem = this.radListControl1.ElementTree.GetElementAtPoint(currentPosition) as RadListVisualItem;
                if (draggedItem != null)
                {
                    string itemText = draggedItem.Text; 

                    if (itemText != string.Empty)
                    {
                        dragObject.Values.Add(AppointmentFields.Summary, itemText);
                        dragObject.Status = AppointmentFields.Summary;
                        //start the drag and drop operation
                        (sender as RadListControl).DoDragDrop(dragObject, DragDropEffects.Copy);
                    }
                }
            }
        }

        private void radScheduler1_DragEnter(object sender, DragEventArgs e)
        {
            DragObject dragObject = e.Data.GetData(typeof(DragObject)) as DragObject;
            //allow dragging over the RadScheduler
            e.Effect = dragObject == null ? DragDropEffects.None : DragDropEffects.Copy;
        }
</code></pre>

<h4><strong>[VB.NET]</strong></h4>

<pre><code>    Private mouseDownPosition As Point
    Private isDragging As Boolean

    Private Sub radListControl1_MouseMove(sender As Object, e As MouseEventArgs)
        If e.Button &lt;&gt; MouseButtons.Left Then
            Me.isDragging = False
            Return
        End If

        If Me.isDragging Then
            Return
        End If

        Dim currentPosition As Point = e.Location
        If (Math.Abs((currentPosition.X - Me.mouseDownPosition.X)) &gt;= SystemInformation.DragSize.Width) OrElse (Math.Abs((currentPosition.Y - Me.mouseDownPosition.Y)) &gt;= SystemInformation.DragSize.Height) Then
            Me.isDragging = True
            Dim dragObject As New DragObject()
            Dim draggedItem As RadListVisualItem = TryCast(Me.RadListControl1.ElementTree.GetElementAtPoint(currentPosition), RadListVisualItem)
            If draggedItem IsNot Nothing Then
                Dim itemText As String = draggedItem.Text

                If itemText &lt;&gt; String.Empty Then
                    dragObject.Values.Add(AppointmentFields.Summary, itemText)
                    dragObject.Status = AppointmentFields.Summary
                    'start the drag and drop operation
                    TryCast(sender, RadListControl).DoDragDrop(dragObject, DragDropEffects.Copy)
                End If
            End If
        End If
    End Sub

    Private Sub radScheduler1_DragEnter(sender As Object, e As DragEventArgs)
        Dim dragObject As DragObject = TryCast(e.Data.GetData(GetType(DragObject)), DragObject)
        'allow dragging over the RadScheduler
        e.Effect = If(dragObject Is Nothing, DragDropEffects.None, DragDropEffects.Copy)
    End Sub

    #End Region

    #Region "DoDragDrop"

    Private Sub radScheduler1_DragDrop(sender As Object, e As DragEventArgs)
        Dim point__1 As Point = Me.RadScheduler1.PointToClient(New Point(e.X, e.Y))
        Dim schedulerCell As SchedulerCellElement = SchedulerUIHelper.GetCellAtPoint(point__1, Me.RadScheduler1)

        If schedulerCell IsNot Nothing Then
            Dim dragObject As DragObject = TryCast(e.Data.GetData(GetType(DragObject)), DragObject)
            If dragObject IsNot Nothing Then
                Dim appointment As Appointment = CreateAppointment(schedulerCell.[Date], dragObject)
                Me.RadScheduler1.Appointments.Add(appointment)

                Dim indexToRemove As Integer = Me.RadListControl1.Items.IndexOf(appointment.Summary)
                If indexToRemove &gt; -1 Then
                    Me.RadListControl1.Items.RemoveAt(indexToRemove)
                End If
            End If
        End If

        Me.mouseDownPosition = Point.Empty
        Me.isDragging = False
        'save changes to database
        SaveChanges()
    End Sub

    #End Region

    #Region "DragHelper"

    Private Function CreateAppointment(currentDate As DateTime, dragObject As DragObject) As Appointment
        Dim appointment As New Appointment()
        Dim startDate As DateTime = currentDate
        Dim endDate As DateTime = currentDate.AddHours(1)
        Select Case dragObject.Status
            Case AppointmentFields.Summary
                appointment.Summary = TryCast(dragObject.Values(dragObject.Status), String)
                Exit Select
            Case AppointmentFields.Row
                appointment.Summary = TryCast(dragObject.Values(AppointmentFields.Summary), String)
                appointment.Description = TryCast(dragObject.Values(AppointmentFields.Description), String)
                appointment.BackgroundId = CInt(dragObject.Values(AppointmentFields.Background))
                appointment.StatusId = CInt(dragObject.Values(AppointmentFields.Status))
                appointment.Location = TryCast(dragObject.Values(AppointmentFields.Location), String)

                startDate = DirectCast(dragObject.Values(AppointmentFields.Start), DateTime)
                endDate = DirectCast(dragObject.Values(AppointmentFields.[End]), DateTime)

                Dim range As TimeSpan = endDate - startDate
                endDate = currentDate + range
                startDate = currentDate

                Exit Select
        End Select
        appointment.Start = startDate
        appointment.[End] = endDate
        Return appointment
    End Function

    Private Enum AppointmentFields
        Row
        Summary
        Location
        Description
        Start
        [End]
        Background
        Status
    End Enum

    Private Class DragObject
        Private m_status As AppointmentFields
        Private m_values As New Dictionary(Of AppointmentFields, Object)()

        Public Property Status() As AppointmentFields
            Get
                Return Me.m_status
            End Get
            Set(value As AppointmentFields)
                Me.m_status = value
            End Set
        End Property

        Public ReadOnly Property Values() As Dictionary(Of AppointmentFields, Object)
            Get
                Return Me.m_values
            End Get
        End Property
    End Class

    #End Region

    #End Region

    Private Sub BindScheduler()
        Dim appointmentMappingInfo As New AppointmentMappingInfo()
        appointmentMappingInfo.BackgroundId = "BackgroundID"
        appointmentMappingInfo.Description = "Description"
        appointmentMappingInfo.[End] = "End"
        appointmentMappingInfo.Location = "Location"
        appointmentMappingInfo.MasterEventId = "ParentID"
        appointmentMappingInfo.RecurrenceRule = "RecurrenceRule"
        appointmentMappingInfo.ResourceId = "ResourceID"
        appointmentMappingInfo.Resources = "Appointments_AppointmentsResources"
        appointmentMappingInfo.Start = "Start"
        appointmentMappingInfo.StatusId = "StatusID"
        appointmentMappingInfo.Summary = "Summary"
        SchedulerBindingDataSource1.EventProvider.Mapping = appointmentMappingInfo

        Dim resourceMappingInfo As New ResourceMappingInfo()
        resourceMappingInfo.Id = "ID"
        resourceMappingInfo.Name = "ResourceName"
        Me.SchedulerBindingDataSource1.ResourceProvider.Mapping = resourceMappingInfo

        SchedulerBindingDataSource1.ResourceProvider.DataSource = SchedulerDataDataSet.Resources
        SchedulerBindingDataSource1.EventProvider.DataSource = SchedulerDataDataSet.Appointments

        RadScheduler1.DataSource = SchedulerBindingDataSource1
    End Sub

    Private Sub SchedulerToListControl_Load(sender As Object, e As EventArgs) Handles MyBase.Load
        'TODO: This line of code loads data into the 'SchedulerDataDataSet.Resources' table. You can move, or remove it, as needed.
        Me.ResourcesTableAdapter.Fill(Me.SchedulerDataDataSet.Resources)
        'TODO: This line of code loads data into the 'SchedulerDataDataSet.AppointmentsResources' table. You can move, or remove it, as needed.
        Me.AppointmentsResourcesTableAdapter.Fill(Me.SchedulerDataDataSet.AppointmentsResources)
        'TODO: This line of code loads data into the 'SchedulerDataDataSet.Appointments' table. You can move, or remove it, as needed.
        Me.AppointmentsTableAdapter.Fill(Me.SchedulerDataDataSet.Appointments)

    End Sub
End Class
</code></pre>

<ol>
<li>In the RadScheduler.<strong>DragDrop</strong> event you need to get the location of the mouse and convert it to a point
        that the scheduler can use to get the cell element underneath the mouse.
        This <strong>MonthCellElement</strong> is passed to a private method <strong>GetCellAppointment()</strong> that we will write next:</li>
</ol>

<h4><strong>[C#]</strong></h4>

<pre><code>        private void radScheduler1_DragDrop(object sender, DragEventArgs e)
        {
            Point point = this.radScheduler1.PointToClient(new Point(e.X, e.Y));
            SchedulerCellElement schedulerCell = SchedulerUIHelper.GetCellAtPoint(point, this.radScheduler1);

            if (schedulerCell != null)
            {
                DragObject dragObject = e.Data.GetData(typeof(DragObject)) as DragObject;
                if (dragObject != null)
                {
                    Appointment appointment = CreateAppointment(schedulerCell.Date, dragObject);
                    this.radScheduler1.Appointments.Add(appointment);

                    int indexToRemove = this.radListControl1.Items.IndexOf(appointment.Summary);
                    if (indexToRemove &gt; -1)
                    {
                        this.radListControl1.Items.RemoveAt(indexToRemove);
                    }
                }
            }

            this.mouseDownPosition = Point.Empty;
            this.isDragging = false;
            //save changes to database
            SaveChanges();
        }
</code></pre>

<h4><strong>[VB.NET]</strong></h4>

<pre><code>    Private Sub radScheduler1_DragDrop(sender As Object, e As DragEventArgs)
        Dim point__1 As Point = Me.RadScheduler1.PointToClient(New Point(e.X, e.Y))
        Dim schedulerCell As SchedulerCellElement = SchedulerUIHelper.GetCellAtPoint(point__1, Me.RadScheduler1)

        If schedulerCell IsNot Nothing Then
            Dim dragObject As DragObject = TryCast(e.Data.GetData(GetType(DragObject)), DragObject)
            If dragObject IsNot Nothing Then
                Dim appointment As Appointment = CreateAppointment(schedulerCell.[Date], dragObject)
                Me.RadScheduler1.Appointments.Add(appointment)

                Dim indexToRemove As Integer = Me.RadListControl1.Items.IndexOf(appointment.Summary)
                If indexToRemove &gt; -1 Then
                    Me.RadListControl1.Items.RemoveAt(indexToRemove)
                End If
            End If
        End If

        Me.mouseDownPosition = Point.Empty
        Me.isDragging = False
        'save changes to database
        SaveChanges()
    End Sub

    #End Region

    #Region "DragHelper"

    Private Function CreateAppointment(currentDate As DateTime, dragObject As DragObject) As Appointment
        Dim appointment As New Appointment()
        Dim startDate As DateTime = currentDate
        Dim endDate As DateTime = currentDate.AddHours(1)
        Select Case dragObject.Status
            Case AppointmentFields.Summary
                appointment.Summary = TryCast(dragObject.Values(dragObject.Status), String)
                Exit Select
            Case AppointmentFields.Row
                appointment.Summary = TryCast(dragObject.Values(AppointmentFields.Summary), String)
                appointment.Description = TryCast(dragObject.Values(AppointmentFields.Description), String)
                appointment.BackgroundId = CInt(dragObject.Values(AppointmentFields.Background))
                appointment.StatusId = CInt(dragObject.Values(AppointmentFields.Status))
                appointment.Location = TryCast(dragObject.Values(AppointmentFields.Location), String)

                startDate = DirectCast(dragObject.Values(AppointmentFields.Start), DateTime)
                endDate = DirectCast(dragObject.Values(AppointmentFields.[End]), DateTime)

                Dim range As TimeSpan = endDate - startDate
                endDate = currentDate + range
                startDate = currentDate

                Exit Select
        End Select
        appointment.Start = startDate
        appointment.[End] = endDate
        Return appointment
    End Function

    Private Enum AppointmentFields
        Row
        Summary
        Location
        Description
        Start
        [End]
        Background
        Status
    End Enum

    Private Class DragObject
        Private m_status As AppointmentFields
        Private m_values As New Dictionary(Of AppointmentFields, Object)()

        Public Property Status() As AppointmentFields
            Get
                Return Me.m_status
            End Get
            Set(value As AppointmentFields)
                Me.m_status = value
            End Set
        End Property

        Public ReadOnly Property Values() As Dictionary(Of AppointmentFields, Object)
            Get
                Return Me.m_values
            End Get
        End Property
    End Class

    #End Region

    #End Region

    Private Sub BindScheduler()
        Dim appointmentMappingInfo As New AppointmentMappingInfo()
        appointmentMappingInfo.BackgroundId = "BackgroundID"
        appointmentMappingInfo.Description = "Description"
        appointmentMappingInfo.[End] = "End"
        appointmentMappingInfo.Location = "Location"
        appointmentMappingInfo.MasterEventId = "ParentID"
        appointmentMappingInfo.RecurrenceRule = "RecurrenceRule"
        appointmentMappingInfo.ResourceId = "ResourceID"
        appointmentMappingInfo.Resources = "Appointments_AppointmentsResources"
        appointmentMappingInfo.Start = "Start"
        appointmentMappingInfo.StatusId = "StatusID"
        appointmentMappingInfo.Summary = "Summary"
        SchedulerBindingDataSource1.EventProvider.Mapping = appointmentMappingInfo

        Dim resourceMappingInfo As New ResourceMappingInfo()
        resourceMappingInfo.Id = "ID"
        resourceMappingInfo.Name = "ResourceName"
        Me.SchedulerBindingDataSource1.ResourceProvider.Mapping = resourceMappingInfo

        SchedulerBindingDataSource1.ResourceProvider.DataSource = SchedulerDataDataSet.Resources
        SchedulerBindingDataSource1.EventProvider.DataSource = SchedulerDataDataSet.Appointments

        RadScheduler1.DataSource = SchedulerBindingDataSource1
    End Sub

    Private Sub SchedulerToListControl_Load(sender As Object, e As EventArgs) Handles MyBase.Load
        'TODO: This line of code loads data into the 'SchedulerDataDataSet.Resources' table. You can move, or remove it, as needed.
        Me.ResourcesTableAdapter.Fill(Me.SchedulerDataDataSet.Resources)
        'TODO: This line of code loads data into the 'SchedulerDataDataSet.AppointmentsResources' table. You can move, or remove it, as needed.
        Me.AppointmentsResourcesTableAdapter.Fill(Me.SchedulerDataDataSet.AppointmentsResources)
        'TODO: This line of code loads data into the 'SchedulerDataDataSet.Appointments' table. You can move, or remove it, as needed.
        Me.AppointmentsTableAdapter.Fill(Me.SchedulerDataDataSet.Appointments)

    End Sub
End Class
</code></pre>

<ol>
<li>The helper method <strong>CreateAppointment()</strong> creates an appointment, starting at the cell where the <strong>RadListControl</strong> item is dropped.
        This appointment gets its data from the dragged item.</li>
</ol>

<h4><strong>[C#]</strong></h4>

<pre><code>        private Appointment CreateAppointment(DateTime currentDate, DragObject dragObject)
        {
            Appointment appointment = new Appointment();
            DateTime startDate = currentDate;
            DateTime endDate = currentDate.AddHours(1);
            switch (dragObject.Status)
            {
                case AppointmentFields.Summary:
                    appointment.Summary = dragObject.Values[dragObject.Status] as string;
                    break;
                case AppointmentFields.Row:
                    appointment.Summary = dragObject.Values[AppointmentFields.Summary] as string;
                    appointment.Description = dragObject.Values[AppointmentFields.Description] as string;
                    appointment.BackgroundId = (int)dragObject.Values[AppointmentFields.Background];
                    appointment.StatusId = (int)dragObject.Values[AppointmentFields.Status];
                    appointment.Location = dragObject.Values[AppointmentFields.Location] as string;

                    startDate = (DateTime)dragObject.Values[AppointmentFields.Start];
                    endDate = (DateTime)dragObject.Values[AppointmentFields.End];

                    TimeSpan range = endDate - startDate;
                    endDate = currentDate + range;
                    startDate = currentDate;

                    break;
            }
            appointment.Start = startDate;
            appointment.End = endDate;
            return appointment;
        }

        private enum AppointmentFields
        {
            Row,
            Summary,
            Location,
            Description,
            Start,
            End,
            Background,
            Status
        }

        private class DragObject
        {
            private AppointmentFields status;
            private Dictionary&lt;AppointmentFields, object&gt; values = new Dictionary&lt;AppointmentFields, object&gt;();

            public AppointmentFields Status
            {
                get
                {
                    return this.status;
                }
                set
                {
                    this.status = value;
                }
            }

            public Dictionary&lt;AppointmentFields, object&gt; Values
            {
                get
                {
                    return this.values;
                }
            }
        }
</code></pre>

<h4><strong>[VB.NET]</strong></h4>

<pre><code>    Private Function CreateAppointment(currentDate As DateTime, dragObject As DragObject) As Appointment
        Dim appointment As New Appointment()
        Dim startDate As DateTime = currentDate
        Dim endDate As DateTime = currentDate.AddHours(1)
        Select Case dragObject.Status
            Case AppointmentFields.Summary
                appointment.Summary = TryCast(dragObject.Values(dragObject.Status), String)
                Exit Select
            Case AppointmentFields.Row
                appointment.Summary = TryCast(dragObject.Values(AppointmentFields.Summary), String)
                appointment.Description = TryCast(dragObject.Values(AppointmentFields.Description), String)
                appointment.BackgroundId = CInt(dragObject.Values(AppointmentFields.Background))
                appointment.StatusId = CInt(dragObject.Values(AppointmentFields.Status))
                appointment.Location = TryCast(dragObject.Values(AppointmentFields.Location), String)

                startDate = DirectCast(dragObject.Values(AppointmentFields.Start), DateTime)
                endDate = DirectCast(dragObject.Values(AppointmentFields.[End]), DateTime)

                Dim range As TimeSpan = endDate - startDate
                endDate = currentDate + range
                startDate = currentDate

                Exit Select
        End Select
        appointment.Start = startDate
        appointment.[End] = endDate
        Return appointment
    End Function

    Private Enum AppointmentFields
        Row
        Summary
        Location
        Description
        Start
        [End]
        Background
        Status
    End Enum

    Private Class DragObject
        Private m_status As AppointmentFields
        Private m_values As New Dictionary(Of AppointmentFields, Object)()

        Public Property Status() As AppointmentFields
            Get
                Return Me.m_status
            End Get
            Set(value As AppointmentFields)
                Me.m_status = value
            End Set
        End Property

        Public ReadOnly Property Values() As Dictionary(Of AppointmentFields, Object)
            Get
                Return Me.m_values
            End Get
        End Property
    End Class

    #End Region

    #End Region

    Private Sub BindScheduler()
        Dim appointmentMappingInfo As New AppointmentMappingInfo()
        appointmentMappingInfo.BackgroundId = "BackgroundID"
        appointmentMappingInfo.Description = "Description"
        appointmentMappingInfo.[End] = "End"
        appointmentMappingInfo.Location = "Location"
        appointmentMappingInfo.MasterEventId = "ParentID"
        appointmentMappingInfo.RecurrenceRule = "RecurrenceRule"
        appointmentMappingInfo.ResourceId = "ResourceID"
        appointmentMappingInfo.Resources = "Appointments_AppointmentsResources"
        appointmentMappingInfo.Start = "Start"
        appointmentMappingInfo.StatusId = "StatusID"
        appointmentMappingInfo.Summary = "Summary"
        SchedulerBindingDataSource1.EventProvider.Mapping = appointmentMappingInfo

        Dim resourceMappingInfo As New ResourceMappingInfo()
        resourceMappingInfo.Id = "ID"
        resourceMappingInfo.Name = "ResourceName"
        Me.SchedulerBindingDataSource1.ResourceProvider.Mapping = resourceMappingInfo

        SchedulerBindingDataSource1.ResourceProvider.DataSource = SchedulerDataDataSet.Resources
        SchedulerBindingDataSource1.EventProvider.DataSource = SchedulerDataDataSet.Appointments

        RadScheduler1.DataSource = SchedulerBindingDataSource1
    End Sub

    Private Sub SchedulerToListControl_Load(sender As Object, e As EventArgs) Handles MyBase.Load
        'TODO: This line of code loads data into the 'SchedulerDataDataSet.Resources' table. You can move, or remove it, as needed.
        Me.ResourcesTableAdapter.Fill(Me.SchedulerDataDataSet.Resources)
        'TODO: This line of code loads data into the 'SchedulerDataDataSet.AppointmentsResources' table. You can move, or remove it, as needed.
        Me.AppointmentsResourcesTableAdapter.Fill(Me.SchedulerDataDataSet.AppointmentsResources)
        'TODO: This line of code loads data into the 'SchedulerDataDataSet.Appointments' table. You can move, or remove it, as needed.
        Me.AppointmentsTableAdapter.Fill(Me.SchedulerDataDataSet.Appointments)

    End Sub
End Class
</code></pre>

<p><img src="images/scheduler-drag-and-drop-combining-raddragdropservice-and-ole-drag-and-drop002.gif" alt="scheduler-drag-and-drop-combining-raddragdropservice-and-ole-drag-and-drop 002"></p>
        </article>
    </div>	
</div>

<footer>	
    <p><a onclick="javascript:SubmitFeedback('documentation@telerik.com','Telerik UI for WinForms','','','','%0\dYour%20feedback%20is%20used%20to%20improve%20the%20documentation%20and%20the%20product.%20Your%20e-mail%20address%20will%20not%20be%20used%20for%20any%20other%20purpose%20and%20is%20disposed%20of%20after%20the%20issue%20you%20report%20is%20resolved.%20%20While%20working%20to%20resolve%20the%20issue%20that%20you%20report,%20you%20may%20be%20contacted%20via%20e-mail%20to%20get%20further%20details%20or%20clarification%20on%20the%20feedback%20you%20sent.%20After%20the%20issue%20you%20report%20has%20been%20addressed,%20you%20may%20receive%20an%20e-mail%20to%20let%20you%20know%20that%20your%20feedback%20has%20been%20addressed.%0\A%0\d','Customer%20Feedback'); return false;" href="javascript:;" id="send-feedback">Send Feedback</a> Copyright &copy; 2002-<span id="toYear"></span> Telerik. All rights reserved.</p>
</footer>

    </body>
</html>

