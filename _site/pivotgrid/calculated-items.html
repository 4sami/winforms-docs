<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=9">
        <title>Calculated items</title>
		
        <link href="/devtools/winforms/favicon.ico?Version=2014" rel="shortcut icon" />
		
        <meta name="description" content="Calculated items">
        <link href="http://cdn.kendostatic.com/2014.2.716/styles/kendo.common.min.css" rel="stylesheet" />
        <link rel="stylesheet" href="/devtools/winforms/assets/styles-0b5a71aa940403cb3ac60d7e91e25e1d.css">
        <link rel="stylesheet" href="/devtools/winforms/assets/theme-52ac78f88dc084a004a9f7d63a3c4245.css">
        <link rel="stylesheet" href="/devtools/winforms/assets/branding-fafb6ed99bf90d251675534381e6f139.css">
        <link rel="stylesheet" href="/devtools/winforms/assets/highlight-49ceada082f1c903edb130c25d09cf1f.css">
        <script src="http://code.jquery.com/jquery-1.10.2.js"></script>
        <script src="http://cdn.kendostatic.com/2014.2.716/js/kendo.web.min.js"></script>
        <script src="/devtools/winforms/assets/prettify-31f05a2784b46b14f119862e47123f4c.js"></script>
        <script src="/devtools/winforms/assets/app-6da8e8e1ef6e19ee4a020ec34f48078c.js"></script>
		<script src="/devtools/winforms/assets/prettify-31f05a2784b46b14f119862e47123f4c.js"></script>
        <script src="/devtools/winforms/assets/branding-59377013fb75f02a1dbffd638033ef6d.js"></script>
		<script src="/devtools/winforms/assets/feedback-76cd418a099f8d21592f412fb4a31191.js"></script>
		
		<!--[if lt IE 9]>
		<script>
		document.createElement('header');
		document.createElement('nav');
		document.createElement('section');
		document.createElement('article');
		document.createElement('aside');
		document.createElement('footer');
		document.createElement('hgroup');
		</script>
		<![endif]-->
    </head>
    <body class="faux-columns">
        <!-- Google Tag Manager -->
        <noscript>
            <iframe src="//www.googletagmanager.com/ns.html?id=GTM-6X92" height="0" width="0" style="display: none; visibility: hidden"></iframe>
        </noscript>
        <script>(function(w, d, s, l, i) { w[l] = w[l] || []; w[l].push({ 'gtm.start': new Date().getTime(), event: 'gtm.js' }); var f = d.getElementsByTagName(s)[0], j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : ''; j.async = true; j.src = '//www.googletagmanager.com/gtm.js?id=' + i + dl; f.parentNode.insertBefore(j, f); })(window, document, 'script', 'dataLayer', 'GTM-6X92');</script>
        <!-- End Google Tag Manager -->
        <header id="page-header">
			<span class="toggle-nav"><span></span></span>
            <div id="logo-bar">
	<a href="/devtools/winforms/" title="UI for WinForms">
		<span>UI for WinForms</span>
	</a>
</div> 
<div id="page-search">
	<script>
  (function() {
    var cx = '001595215763381649090:jt1stbj813w';
    var gcse = document.createElement('script');
    gcse.async = true;
    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
        '//www.google.com/cse/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>

</div>

<span class="show-search">
	<span class="k-icon k-i-search"></span>
</span>

<div class="nav-buttons">
	<a href="http://demos.telerik.com/wpf/" title="WPF Demos" target="_blank" class="btn demos-btn">Demos</a>	
	<a href="http://www.telerik.com/products/wpf/overview.aspx" title="About UI for WPF" target="_blank" class="btn about-btn">About</a>
	<a href="http://www.telerik.com/purchase/individual/wpf.aspx" title="Pricing" target="_blank" class="btn pricing-btn">Pricing</a>
	<a href="http://www.telerik.com/products/wpf/download.aspx" title="Try now" target="_blank" class="btn btn-primary">Try now</a>
</div>





        </header>

        <div id="page-inner-content">
    <div id="page-nav">
        <div id="page-tree"></div>
        <script>
			$("#page-tree").kendoTreeView({
				dataSource: {
					transport: {
						read: {
							url: "/devtools/winforms/default.json",
							dataType: "json"
						}
					},
					schema: {
						model: {
							id: "path",
							children: "items",
							hasChildren: "items"
						}
					}
				},
				select: preventParentSelection,
				template: navigationTemplate("/devtools/winforms/"),
				dataBound: expandNavigation("pivotgrid/calculated-items.html")
			});
        </script>
		<div id="page-api" class="k-treeview">
			<ul class="k-group">
				<li class="k-item">
					<span class="k-icon k-plus" role="presentation"></span>
					<span class="k-in">
						<a href="/devtools/winforms/api/" target="_blank">API Reference</a>
					</span>
				</li>
			</ul>
		</div>			
    </div>
	<a id="page-edit-link" class="btn btn-action" href="https://github.com/telerik/xaml-docs/edit/master/pivotgrid/calculated-items.md">Edit this page</a>
    <div id="page-article">       
        <article>
            <h1 id="calculated-items"><a href="#calculated-items">Calculated items</a></h1>

<p>A calculated item is a new item in a row or column field in which the values are the result of a custom calculation.<br>
        In this case, the calculated itemâ€™s formula references one or more items in the same field.</p>

<pre><code>    By using Calculated Items you are able to extend __RadPivotGrid__ with additional items 
    that are not part of the data source.
</code></pre>

<h2 id="defining-calculated-item"><a href="#defining-calculated-item">Defining Calculated Item</a></h2>

<p>With <strong>RadPivotGrid</strong> you are able to create different Groups that will be shown in Rows and Columns. <br>
          But in some cases you may need to show additional items for specific group. In this case you may use Calculated Items.<br>
          Calculated Items are added to a group description and they have access to different items from the same group.<br>
          For example, lets say we want to calculate the average sales made by some of the sales people, but not all of them. <br>
          First we have to create a concrete class that implements the abstract <em>CalculatedItem</em> class.</p>

<pre><code>      For this purpose the new class must implement GetValue method. In our scenario we'll show the average sales of four 
      of the sales people:
</code></pre>

<h4>__[C#] __</h4>

<pre><code>    public class MenAverageSales : CalculatedItem
    {
        protected override AggregateValue GetValue(IAggregateSummaryValues aggregateSummaryValues)
        {
            AggregateValue[] aggregateValues = {
            aggregateSummaryValues.GetAggregateValue("Andrew Fuller"),
            aggregateSummaryValues.GetAggregateValue("Michael Suyama"),
            aggregateSummaryValues.GetAggregateValue("Robert King"),
            aggregateSummaryValues.GetAggregateValue("Steven Buchanan")
        };

            if (aggregateValues.ContainsError())
            {
                return AggregateValue.ErrorAggregateValue;
            }

            double average = aggregateValues.Average(av =&gt; av.ConvertOrDefault&lt;double&gt;());
            return new DoubleAggregateValue(average);
        }
    }
</code></pre>

<h4>__[VB.NET] __</h4>

<pre><code>Public Class MenAverageSales
    Inherits CalculatedItem
    Protected Overrides Function GetValue(aggregateSummaryValues As IAggregateSummaryValues) As AggregateValue
        Dim aggregateValues As AggregateValue() = {aggregateSummaryValues.GetAggregateValue("Andrew Fuller"), aggregateSummaryValues.GetAggregateValue("Michael Suyama"), aggregateSummaryValues.GetAggregateValue("Robert King"), aggregateSummaryValues.GetAggregateValue("Steven Buchanan")}

        If aggregateValues.ContainsError() Then
            Return AggregateValue.ErrorAggregateValue
        End If

        Dim average As Double = aggregateValues.Average(Function(av) av.ConvertOrDefault(Of Double)())
        Return New DoubleAggregateValue(average)
    End Function
End Class
#End Region

#Region "CA"
Public Class CA
    Inherits CalculatedItem
    Protected Overrides Function GetValue(aggregateSummaryValues As IAggregateSummaryValues) As AggregateValue
        Dim aggregateValue__1 As AggregateValue = aggregateSummaryValues.GetAggregateValue("Canada")

        If aggregateValue__1.IsError() Then
            Return AggregateValue.ErrorAggregateValue
        End If

        Dim value = If(aggregateValue__1.ConvertOrDefault(Of Double)() &gt; 500, 500, 0)
        Return New DoubleAggregateValue(value)
    End Function
End Class
#End Region
</code></pre>

<p>As you can see the Calculated Item will show the average sales of four people. Now we just have to add it to<br>
          the PropertyGroupDescription. In our case this will be the Salesperson group:</p>

<h4>__[C#] __</h4>

<pre><code>            PropertyGroupDescription salesPersonGroupDescription = new PropertyGroupDescription();
            salesPersonGroupDescription.PropertyName = "Salesperson";

            MenAverageSales calculatedItem = new MenAverageSales();
            calculatedItem.GroupName = "Average Sales (Men)";
            salesPersonGroupDescription.CalculatedItems.Add(calculatedItem);
            localProvider.ColumnGroupDescriptions.Add(salesPersonGroupDescription);
</code></pre>

<h4>__[VB.NET] __</h4>

<pre><code>        Dim salesPersonGroupDescription As New PropertyGroupDescription()
        salesPersonGroupDescription.PropertyName = "Salesperson"

        Dim calculatedItem As New MenAverageSales()
        calculatedItem.GroupName = "Average Sales (Men)"
        salesPersonGroupDescription.CalculatedItems.Add(calculatedItem)
        localProvider.ColumnGroupDescriptions.Add(salesPersonGroupDescription)
        '#End Region

        localProvider.AggregateDescriptions.Add(New PropertyAggregateDescription() With { _
             .PropertyName = "ExtendedPrice", _
             .AggregateFunction = AggregateFunctions.Sum, _
             .StringFormat = "N" _
        })

        localProvider.ItemsSource = Invoice.GetInvoices()

        Me.RadPivotGrid1.DataProvider = localProvider
        Me.RadPivotGrid1.ErrorString = "Error"
    End Sub

    Private Sub AddCalcItemWithSortOrder()
        AddHandler localProvider.PrepareDescriptionForField, AddressOf localProvider_PrepareDescriptionForField

        '#Region "AddCalcItemWithSortOrder"
        Dim salesPersonGroupDescription As New PropertyGroupDescription()
        salesPersonGroupDescription.PropertyName = "Salesperson"

        Dim menAvgSalesCalculatedItem As New MenAverageSales()
        menAvgSalesCalculatedItem.GroupName = "Average Sales (Men)"
        menAvgSalesCalculatedItem.SolveOrder = 1
        salesPersonGroupDescription.CalculatedItems.Add(menAvgSalesCalculatedItem)

        Dim countryGroupDescription As New PropertyGroupDescription()
        countryGroupDescription.PropertyName = "Country"
        Dim caCalculatedItem As New CA()
        caCalculatedItem.GroupName = "CA"
        caCalculatedItem.SolveOrder = 2
        countryGroupDescription.CalculatedItems.Add(caCalculatedItem)


        localProvider.ColumnGroupDescriptions.Add(salesPersonGroupDescription)
        localProvider.RowGroupDescriptions.Add(countryGroupDescription)
        '#End Region

        localProvider.AggregateDescriptions.Add(New PropertyAggregateDescription() With { _
            .PropertyName = "ExtendedPrice", _
            .AggregateFunction = AggregateFunctions.Sum, _
            .StringFormat = "N" _
        })

        localProvider.ItemsSource = Invoice.GetInvoices()

        Me.RadPivotGrid1.DataProvider = localProvider
        Me.RadPivotGrid1.ErrorString = "Error"
    End Sub

#Region "localProvider_PrepareDescriptionForField"
    Private Sub localProvider_PrepareDescriptionForField(sender As Object, e As PrepareDescriptionForFieldEventArgs)
        If e.DescriptionType = DataProviderDescriptionType.Group AndAlso e.FieldInfo.DisplayName = "Salesperson" Then
            Dim description = TryCast(e.Description, Telerik.Pivot.Core.PropertyGroupDescription)

            If description IsNot Nothing Then
                Dim calculatedItem = New MenAverageSales()
                calculatedItem.GroupName = "Average Sales (Men)"
                description.CalculatedItems.Add(calculatedItem)
            End If
        End If
    End Sub
#End Region
End Class

#Region "CalculatedItemClasses"
Public Class MenAverageSales
    Inherits CalculatedItem
    Protected Overrides Function GetValue(aggregateSummaryValues As IAggregateSummaryValues) As AggregateValue
        Dim aggregateValues As AggregateValue() = {aggregateSummaryValues.GetAggregateValue("Andrew Fuller"), aggregateSummaryValues.GetAggregateValue("Michael Suyama"), aggregateSummaryValues.GetAggregateValue("Robert King"), aggregateSummaryValues.GetAggregateValue("Steven Buchanan")}

        If aggregateValues.ContainsError() Then
            Return AggregateValue.ErrorAggregateValue
        End If

        Dim average As Double = aggregateValues.Average(Function(av) av.ConvertOrDefault(Of Double)())
        Return New DoubleAggregateValue(average)
    End Function
End Class
#End Region

#Region "CA"
Public Class CA
    Inherits CalculatedItem
    Protected Overrides Function GetValue(aggregateSummaryValues As IAggregateSummaryValues) As AggregateValue
        Dim aggregateValue__1 As AggregateValue = aggregateSummaryValues.GetAggregateValue("Canada")

        If aggregateValue__1.IsError() Then
            Return AggregateValue.ErrorAggregateValue
        End If

        Dim value = If(aggregateValue__1.ConvertOrDefault(Of Double)() &gt; 500, 500, 0)
        Return New DoubleAggregateValue(value)
    End Function
End Class
#End Region
</code></pre>

<p><img src="images/pivotgrid-calculated-items001.png" alt="pivotgrid-calculated-items 001"></p>

<h2 id="add-calculated-items-at-runtime"><a href="#add-calculated-items-at-runtime">Add Calculated Items at runtime</a></h2>

<p>Calculated items can be added only to Group Descriptions. If you are using <strong>RadPivotFieldList</strong> the users can remove<br>
          the group for which you've added calculated items and this way the calculated items will be removed as well. Adding the same group in rows or columns will not show<br>
          the calculated items anymore. In order to add them again you have to use <em>PrepareDescriptionForField</em><br>
          event of LocalDataSourceProvider and add the calculated items to the description:</p>

<h4>__[C#] __</h4>

<pre><code>        void localProvider_PrepareDescriptionForField(object sender, PrepareDescriptionForFieldEventArgs e)
        {
            if (e.DescriptionType == DataProviderDescriptionType.Group &amp;&amp; e.FieldInfo.DisplayName == "Salesperson")
            {
                var description = e.Description as Telerik.Pivot.Core.PropertyGroupDescription;

                if (description != null)
                {
                    var calculatedItem = new MenAverageSales();
                    calculatedItem.GroupName = "Average Sales (Men)";
                    description.CalculatedItems.Add(calculatedItem);
                }
            }
        }
</code></pre>

<h4>__[VB.NET] __</h4>

<pre><code>    Private Sub localProvider_PrepareDescriptionForField(sender As Object, e As PrepareDescriptionForFieldEventArgs)
        If e.DescriptionType = DataProviderDescriptionType.Group AndAlso e.FieldInfo.DisplayName = "Salesperson" Then
            Dim description = TryCast(e.Description, Telerik.Pivot.Core.PropertyGroupDescription)

            If description IsNot Nothing Then
                Dim calculatedItem = New MenAverageSales()
                calculatedItem.GroupName = "Average Sales (Men)"
                description.CalculatedItems.Add(calculatedItem)
            End If
        End If
    End Sub
#End Region
End Class

#Region "CalculatedItemClasses"
Public Class MenAverageSales
    Inherits CalculatedItem
    Protected Overrides Function GetValue(aggregateSummaryValues As IAggregateSummaryValues) As AggregateValue
        Dim aggregateValues As AggregateValue() = {aggregateSummaryValues.GetAggregateValue("Andrew Fuller"), aggregateSummaryValues.GetAggregateValue("Michael Suyama"), aggregateSummaryValues.GetAggregateValue("Robert King"), aggregateSummaryValues.GetAggregateValue("Steven Buchanan")}

        If aggregateValues.ContainsError() Then
            Return AggregateValue.ErrorAggregateValue
        End If

        Dim average As Double = aggregateValues.Average(Function(av) av.ConvertOrDefault(Of Double)())
        Return New DoubleAggregateValue(average)
    End Function
End Class
#End Region

#Region "CA"
Public Class CA
    Inherits CalculatedItem
    Protected Overrides Function GetValue(aggregateSummaryValues As IAggregateSummaryValues) As AggregateValue
        Dim aggregateValue__1 As AggregateValue = aggregateSummaryValues.GetAggregateValue("Canada")

        If aggregateValue__1.IsError() Then
            Return AggregateValue.ErrorAggregateValue
        End If

        Dim value = If(aggregateValue__1.ConvertOrDefault(Of Double)() &gt; 500, 500, 0)
        Return New DoubleAggregateValue(value)
    End Function
End Class
#End Region
</code></pre>

<h2 id="solve-order"><a href="#solve-order">Solve Order</a></h2>

<p>If you have calculated items in both rows and columns group descriptions, you have to define which of them will be used for the intersected cells. That's why each Calculated Item has <em>SolveOrder</em><br>
          property - when a cell is an intersection between two calculated items the one with higher solve order will be used.</p>

<h4>__[C#] __</h4>

<pre><code>            PropertyGroupDescription salesPersonGroupDescription = new PropertyGroupDescription();
            salesPersonGroupDescription.PropertyName = "Salesperson";

            MenAverageSales menAvgSalesCalculatedItem  = new MenAverageSales();
            menAvgSalesCalculatedItem .GroupName = "Average Sales (Men)";
            menAvgSalesCalculatedItem .SolveOrder = 1;
            salesPersonGroupDescription.CalculatedItems.Add(menAvgSalesCalculatedItem);

            PropertyGroupDescription countryGroupDescription = new PropertyGroupDescription();
            countryGroupDescription.PropertyName = "Country";
            CA caCalculatedItem = new CA();
            caCalculatedItem.GroupName = "CA";
            caCalculatedItem.SolveOrder = 2;
            countryGroupDescription.CalculatedItems.Add(caCalculatedItem);


            localProvider.ColumnGroupDescriptions.Add(salesPersonGroupDescription);
            localProvider.RowGroupDescriptions.Add(countryGroupDescription);
</code></pre>

<h4>__[VB.NET] __</h4>

<pre><code>        Dim salesPersonGroupDescription As New PropertyGroupDescription()
        salesPersonGroupDescription.PropertyName = "Salesperson"

        Dim menAvgSalesCalculatedItem As New MenAverageSales()
        menAvgSalesCalculatedItem.GroupName = "Average Sales (Men)"
        menAvgSalesCalculatedItem.SolveOrder = 1
        salesPersonGroupDescription.CalculatedItems.Add(menAvgSalesCalculatedItem)

        Dim countryGroupDescription As New PropertyGroupDescription()
        countryGroupDescription.PropertyName = "Country"
        Dim caCalculatedItem As New CA()
        caCalculatedItem.GroupName = "CA"
        caCalculatedItem.SolveOrder = 2
        countryGroupDescription.CalculatedItems.Add(caCalculatedItem)


        localProvider.ColumnGroupDescriptions.Add(salesPersonGroupDescription)
        localProvider.RowGroupDescriptions.Add(countryGroupDescription)
        '#End Region

        localProvider.AggregateDescriptions.Add(New PropertyAggregateDescription() With { _
            .PropertyName = "ExtendedPrice", _
            .AggregateFunction = AggregateFunctions.Sum, _
            .StringFormat = "N" _
        })

        localProvider.ItemsSource = Invoice.GetInvoices()

        Me.RadPivotGrid1.DataProvider = localProvider
        Me.RadPivotGrid1.ErrorString = "Error"
    End Sub

#Region "localProvider_PrepareDescriptionForField"
    Private Sub localProvider_PrepareDescriptionForField(sender As Object, e As PrepareDescriptionForFieldEventArgs)
        If e.DescriptionType = DataProviderDescriptionType.Group AndAlso e.FieldInfo.DisplayName = "Salesperson" Then
            Dim description = TryCast(e.Description, Telerik.Pivot.Core.PropertyGroupDescription)

            If description IsNot Nothing Then
                Dim calculatedItem = New MenAverageSales()
                calculatedItem.GroupName = "Average Sales (Men)"
                description.CalculatedItems.Add(calculatedItem)
            End If
        End If
    End Sub
#End Region
End Class

#Region "CalculatedItemClasses"
Public Class MenAverageSales
    Inherits CalculatedItem
    Protected Overrides Function GetValue(aggregateSummaryValues As IAggregateSummaryValues) As AggregateValue
        Dim aggregateValues As AggregateValue() = {aggregateSummaryValues.GetAggregateValue("Andrew Fuller"), aggregateSummaryValues.GetAggregateValue("Michael Suyama"), aggregateSummaryValues.GetAggregateValue("Robert King"), aggregateSummaryValues.GetAggregateValue("Steven Buchanan")}

        If aggregateValues.ContainsError() Then
            Return AggregateValue.ErrorAggregateValue
        End If

        Dim average As Double = aggregateValues.Average(Function(av) av.ConvertOrDefault(Of Double)())
        Return New DoubleAggregateValue(average)
    End Function
End Class
#End Region

#Region "CA"
Public Class CA
    Inherits CalculatedItem
    Protected Overrides Function GetValue(aggregateSummaryValues As IAggregateSummaryValues) As AggregateValue
        Dim aggregateValue__1 As AggregateValue = aggregateSummaryValues.GetAggregateValue("Canada")

        If aggregateValue__1.IsError() Then
            Return AggregateValue.ErrorAggregateValue
        End If

        Dim value = If(aggregateValue__1.ConvertOrDefault(Of Double)() &gt; 500, 500, 0)
        Return New DoubleAggregateValue(value)
    End Function
End Class
#End Region
</code></pre>

<p>Here is the result:<br>
        <img src="images/pivotgrid-calculated-items002.png" alt="pivotgrid-calculated-items 002"></p>

<p>As you can see the intersected cell between the two calculated items has value 500 as the CA calculated item has higher solve order. If we change the solve order of Men Average Sales to a higher value,<br>
          for example 5, here is how <strong>RadPivotGrid</strong> will look like:<br>
        <img src="images/pivotgrid-calculated-items003.png" alt="pivotgrid-calculated-items 003"></p>
        </article>
    </div>	
</div>

<footer>	
    <p><a onclick="javascript:SubmitFeedback('documentation@telerik.com','Telerik UI for WinForms','','','','%0\dYour%20feedback%20is%20used%20to%20improve%20the%20documentation%20and%20the%20product.%20Your%20e-mail%20address%20will%20not%20be%20used%20for%20any%20other%20purpose%20and%20is%20disposed%20of%20after%20the%20issue%20you%20report%20is%20resolved.%20%20While%20working%20to%20resolve%20the%20issue%20that%20you%20report,%20you%20may%20be%20contacted%20via%20e-mail%20to%20get%20further%20details%20or%20clarification%20on%20the%20feedback%20you%20sent.%20After%20the%20issue%20you%20report%20has%20been%20addressed,%20you%20may%20receive%20an%20e-mail%20to%20let%20you%20know%20that%20your%20feedback%20has%20been%20addressed.%0\A%0\d','Customer%20Feedback'); return false;" href="javascript:;" id="send-feedback">Send Feedback</a> Copyright &copy; 2002-<span id="toYear"></span> Telerik. All rights reserved.</p>
</footer>

    </body>
</html>

